positionTypes={globalP=1,localP=2}orientationTypes={globalO=1,localO=2}CameraTypes={fixed={fLocal={name="fLocal",id=0},fGlobal={name="fGlobal",id=1}},player={name="player",id=2}}function getManager()local self={}local function a(b,c,d,e,f,g,h,i,j)local k=b+f+j;if k>0 then local l=0.5/(k+1)^0.5;return(g-i)*l,(h-d)*l,(c-e)*l,0.25/l elseif b>f and b>j then local l=1/(2*(1+b-f-j)^0.5)return 0.25/l,(e+c)*l,(h+d)*l,(g-i)*l elseif f>j then local l=1/(2*(1+f-b-j)^0.5)return(e+c)*l,0.25/l,(i+g)*l,(h-d)*l else local l=1/(2*(1+j-b-f)^0.5)return(h+d)*l,(i+g)*l,0.25/l,(c-e)*l end end;local function m(n,o,p)if o and p then return a(n[1],n[2],n[3],o[1],o[2],o[3],p[1],p[2],p[3])else return a(n[1],n[5],n[9],n[2],n[6],n[10],n[3],n[7],n[11])end end;self.matrixToQuat=a;self.rotMatrixToQuat=m;local function q(r,s)local t,u,v,w,x,type=math.rad,math.sin,math.cos,math.random,system.print,type;local function y(z,A,B,C)if type(z)=='number'then if C==nil then if z==z and A==A and B==B then z=-t(z*0.5)A=t(A*0.5)B=-t(B*0.5)local l,D=u,v;local E,F,G=l(z),l(A),l(B)local H,I,J=D(z),D(A),D(B)return E*I*J-H*F*G,H*F*J+E*I*G,H*I*G-E*F*J,H*I*J+E*F*G else return 0,0,0,1 end else return z,A,B,C end elseif type(z)=='table'then if#z==3 then return m(z,A,B)elseif#z==4 then return z[1],z[2],z[3],z[4]else x('Unsupported Rotation!')end end end;local function K(L,M,N,O,P,Q,R,S)return L*S+O*P+M*R-N*Q,M*S+O*Q+N*P-L*R,N*S+O*R+L*Q-M*P,O*S-L*P-M*Q-N*R end;local function T(L,M,N,O,U,V,W,X,Y,Z)local _,a0,a1,a2=L*L,M*M,N*N,O*O;return 2*(V*(L*M-O*N)+W*(L*N+O*M))+U*(a2+_-a0-a1)+X,2*(U*(O*N+L*M)+W*(M*N-O*L))+V*(a2-_+a0-a1)+Y,2*(U*(L*N-O*M)+V*(L*O+M*N))+W*(a2-_-a0+a1)+Z end;local a3,a4=nil,false;local a5=nil;local a6,pY,a7=s[1],s[2],s[3]local a8,a9,aa=0,0,0;local ab=s;local ac=false;local ad,ae,af,ag=0,0,0,1;local ah,ai,aj,ak=0,0,0,1;local al,am,an,ao=0,0,0,1;local ap,aq,ar,as=0,0,0,1;local at=r;local au={}local av={}local function aw(wx,wy,wz,ww,ax,ay,az,aA,aB,aC)wx,wy,wz,ww=wx or 0,wy or 0,wz or 0,ww or 1;ax,ay,az=ax or a6,ay or pY,az or a7;aA,aB,aC=aA or a6,aB or pY,aC or a7;local aD,aE,aF;if not ac then aD,aE,aF=a6-ax,pY-ay,a7-az else aD,aE,aF=a6,pY,a7 end;if ww~=1 and ww~=-1 then if aD~=0 or aE~=0 or aF~=0 then ab[1],ab[2],ab[3]=T(wx,wy,wz,ww,aD,aE,aF,aA,aB,aC)else ab[1],ab[2],ab[3]=aA,aB+w()*0.00001,aC end;if as~=1 then wx,wy,wz,ww=K(wx,wy,wz,ww,ap,aq,ar,as)end;if ao~=1 then wx,wy,wz,ww=K(wx,wy,wz,ww,al,am,an,ao)end else ab[1],ab[2],ab[3]=aA+aD,aB+aE,aC+aF;if as~=1 then if ao~=1 then wx,wy,wz,ww=K(ap,aq,ar,as,al,am,an,ao)else wx,wy,wz,ww=ap,aq,ar,as end else if ao~=1 then wx,wy,wz,ww=al,am,an,ao end end end;at[1],at[2],at[3],at[4]=wx,wy,wz,ww;for aG=1,#au do au[aG].update(wx,wy,wz,ww,a6,pY,a7,ab[1],ab[2],ab[3])end;a4=false end;av.update=aw;local function aH()if not a3 then aw()else a3.bubble()end end;local function aI(aJ)if aJ then ap,aq,ar,as=y(ah,ai,aj,ak)else al,am,an,ao=y(ad,ae,af,ag)end;aH()end;function av.setSuperManager(aK)a3=aK end;function av.addSubRotation(aK)aK.setSuperManager(av)au[#au+1]=aK;aw()end;function av.bubble()if a3 then a3.bubble()else a4=true end end;a5=av.bubble;function av.checkUpdate()if a4 then aw()end;return a4 end;local function aL(aM,aN)aM.update=aw;function aM.getPosition()return a6,pY,a7 end;function aM.getRotationManger()return av end;function aM.setPosition(aO,aP,aQ)if not(aO~=aO or aP~=aP or aQ~=aQ)then a6,pY,a7=aO,aP+w()*0.00001,aQ;a5()end end;function aM.rotateXYZ(aR,aS,aT,aU)if aR and aS and aT then ad,ae,af,ag=aR,aS,aT,aU;aI(false)if aN then aN()end else if type(aR)=='table'then if#aR==3 then ad,ae,af,ag=aR[1],aR[2],aR[3],nil;if aN then aN()end;goto aV end end;x('Invalid format. Must be three angles, or right, forward and up vectors, or a quaternion. Use radians if angles.')::aV::end end;function aM.rotateX(aR)ad=aR;ag=nil;aI(false)if aN then aN()end end;function aM.rotateY(aS)ae=aS;ag=nil;aI(false)if aN then aN()end end;function aM.rotateZ(aT)af=aT;ag=nil;aI(false)if aN then aN()end end;function aM.rotateDefaultXYZ(aR,aS,aT,aU)if aR and aS and aT then ah,ai,aj,ak=aR,aS,aT,aU;aI(true)if aN then aN()end else if type(aR)=='table'then if#aR==3 then ah,ai,aj,ak=aR[1],aR[2],aR[3],nil;if aN then aN()end;goto aV end end;x('Invalid format. Must be three angles, or right, forward and up vectors, or a quaternion. Use radians if angles.')::aV::end end;function aM.rotateDefaultX(aR)ah=aR;ak=nil;aI(true)if aN then aN()end end;function aM.rotateDefaultY(aS)ai=aS;ak=nil;aI(true)if aN then aN()end end;function aM.rotateDefaultZ(aT)aj=aT;ak=nil;aI(true)if aN then aN()end end;function aM.setPositionIsRelative(aW)ac=true;a5()end end;av.assignFunctions=aL;return av end;self.getRotationManager=q;return self end;function Camera(aX,aY,aZ)local t=math.rad;local a_=aZ or{0,0,0,1}local b0=aY or{0,0,0}local b1=getManager().getRotationManager(aZ,aY)local self={cType=aX or CameraTypes.player,position=b0,orientation=a_}b1.assignFunctions(self)return self end;local x=system.print;local b2={[10]={{},16,'',10},[32]={{},10,'',32},[33]={{4,0,3,2,5,2,4,4,4,12},10,'M%g %gL%g %gL%g %gZ M%g %gL%g %g',33},[34]={{2,10,2,6,6,10,6,6},6,'M%g %gL%g %g M%g %gL%g %g',34},[35]={{0,4,8,4,6,2,6,10,8,8,0,8,2,10,2,2},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g',35},[36]={{6,2,2,6,6,10,4,12,4,0},6,'M%g %gL%g %gL%g %g M%g %gL%g %g',36},[37]={{0,0,8,12,2,10,2,8,6,4,6,2},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g',37},[38]={{8,0,4,12,8,8,0,4,4,0,8,4},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g',38},[39]={{0,8,0,12},2,'M%g %gL%g %g',39},[40]={{6,0,2,4,2,8,6,12},8,'M%g %gL%g %gL%g %gL%g %g',40},[41]={{2,0,6,4,6,8,2,12},8,'M%g %gL%g %gL%g %gL%g %g',41},[42]={{0,0,4,12,8,0,0,8,8,8,0,0},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g',42},[43]={{1,6,7,6,4,9,4,3},10,'M%g %gL%g %gM%g %gL%g %g',43},[44]={{-1,-2,1,1},4,'M%g %gL%g %g',44},[45]={{2,6,6,6},10,'M%g %gL%g %g',45},[46]={{0,0,1,0},3,'M%g %gL%g %g',46},[47]={{0,0,8,12},10,'M%g %gL%g %g',47},[48]={{0,0,8,0,8,12,0,12,0,0,8,12},10,'M%g %gL%g %gL%g %gL%g %gZ M%g %gL%g %g',48},[49]={{5,0,5,12,3,10},10,'M%g %gL%g %gL%g %g',49},[50]={{0,12,8,12,8,7,0,5,0,0,8,0},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g',50},[51]={{0,12,8,12,8,0,0,0,0,6,8,6},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',51},[52]={{0,12,0,6,8,6,8,12,8,0},10,'M%g %gL%g %gL%g %g M%g %gL%g %g',52},[53]={{0,0,8,0,8,6,0,7,0,12,8,12},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g',53},[54]={{0,12,0,0,8,0,8,5,0,7},10,'M%g %gL%g %gL%g %gL%g %gL%g %g',54},[55]={{0,12,8,12,8,6,4,0},10,'M%g %gL%g %gL%g %gL%g %g',55},[56]={{0,0,8,0,8,12,0,12,0,6,8,6},10,'M%g %gL%g %gL%g %gL%g %gZ M%g %gL%g %g',56},[57]={{8,0,8,12,0,12,0,7,8,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g',57},[58]={{4,9,4,7,4,5,4,3},2,'M%g %gL%g %g M%g %gL%g %g',58},[59]={{4,9,4,7,4,5,1,2},5,'M%g %gL%g %g M%g %gL%g %g',59},[60]={{6,0,2,6,6,12},6,'M%g %gL%g %gL%g %g',60},[61]={{1,4,7,4,1,8,7,8},8,'M%g %gL%g %g M%g %gL%g %g',61},[62]={{2,0,6,6,2,12},6,'M%g %gL%g %gL%g %g',62},[63]={{0,8,4,12,8,8,4,4,4,1,4,0},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',63},[64]={{8,4,4,0,0,4,0,8,4,12,8,8,4,4,3,6},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %g',64},[65]={{0,0,0,8,4,12,8,8,8,0,0,4,8,4},10,'M%g %gL%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',65},[66]={{0,0,0,12,4,12,8,10,4,6,8,2,4,0},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %gZ',66},[67]={{8,0,0,0,0,12,8,12},10,'M%g %gL%g %gL%g %gL%g %g',67},[68]={{0,0,0,12,4,12,8,8,8,4,4,0},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gZ',68},[69]={{8,0,0,0,0,12,8,12,0,6,6,6},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',69},[70]={{0,0,0,12,8,12,0,6,6,6},10,'M%g %gL%g %gL%g %g M%g %gL%g %g',70},[71]={{6,6,8,4,8,0,0,0,0,12,8,12},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g',71},[72]={{0,0,0,12,0,6,8,6,8,12,8,0},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g',72},[73]={{0,0,8,0,4,0,4,12,0,12,8,12},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g',73},[74]={{0,4,4,0,8,0,8,12},10,'M%g %gL%g %gL%g %gL%g %g',74},[75]={{0,0,0,12,8,12,0,6,6,0},10,'M%g %gL%g %g M%g %gL%g %gL%g %g',75},[76]={{8,0,0,0,0,12},10,'M%g %gL%g %gL%g %g',76},[77]={{0,0,0,12,4,8,8,12,8,0},10,'M%g %gL%g %gL%g %gL%g %gL%g %g',77},[78]={{0,0,0,12,8,0,8,12},10,'M%g %gL%g %gL%g %gL%g %g',78},[79]={{0,0,0,12,8,12,8,0},10,'M%g %gL%g %gL%g %gL%g %gZ',79},[80]={{0,0,0,12,8,12,8,6,0,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g',80},[81]={{0,0,0,12,8,12,8,4,4,4,8,0},10,'M%g %gL%g %gL%g %gL%g %gZ M%g %gL%g %g',81},[82]={{0,0,0,12,8,12,8,6,0,5,4,5,8,0},10,'M%g %gL%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',82},[83]={{0,2,2,0,8,0,8,5,0,7,0,12,6,12,8,10},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %g',83},[84]={{0,12,8,12,4,12,4,0},10,'M%g %gL%g %g M%g %gL%g %g',84},[85]={{0,12,0,2,4,0,8,2,8,12},10,'M%g %gL%g %gL%g %gL%g %gL%g %g',85},[86]={{0,12,4,0,8,12},10,'M%g %gL%g %gL%g %g',86},[87]={{0,12,2,0,4,4,6,0,8,12},10,'M%g %gL%g %gL%g %gL%g %gL%g %g',87},[88]={{0,0,8,12,0,12,8,0},10,'M%g %gL%g %g M%g %gL%g %g',88},[89]={{0,12,4,6,8,12,4,6,4,0},10,'M%g %gL%g %gL%g %g M%g %gL%g %g',89},[90]={{0,12,8,12,0,0,8,0,2,6,6,6},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',90},[91]={{6,0,2,0,2,12,6,12},6,'M%g %gL%g %gL%g %gL%g %g',91},[92]={{0,12,8,0},10,'M%g %gL%g %g',92},[93]={{2,0,6,0,6,12,2,12},6,'M%g %gL%g %gL%g %gL%g %g',93},[94]={{2,6,4,12,6,6},6,'M%g %gL%g %gL%g %g',94},[95]={{0,0,8,0},10,'M%g %gL%g %g',95},[96]={{2,12,6,8},6,'M%g %gL%g %g',96},[123]={{6,0,4,2,4,10,6,12,2,6,4,6},6,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',123},[124]={{4,0,4,5,4,6,4,12},6,'M%g %gL%g %g M%g %gL%g %g',124},[125]={{4,0,6,2,6,10,4,12,6,6,8,6},6,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g',125},[126]={{0,4,2,8,6,4,8,8},10,'M%g %gL%g %gL%g %gL%g %g',126}}function ObjectGroup(b3,b4,b5)local b3=b3 or{}local self={style='',gStyle='',objects=b3,transX=b4,transY=b5,enabled=true,glow=false,gRad=10,scale=false}function self.addObject(b6,b7)local b7=b7 or#b3+1;b3[b7]=b6;return b7 end;function self.removeObject(b7)b3[b7]={}end;function self.hide()self.enabled=false end;function self.show()self.enabled=true end;function self.isEnabled()return self.enabled end;function self.setStyle(b8)self.style=b8 end;function self.setGlowStyle(b9)self.gStyle=b9 end;function self.setGlow(ba,bb,bc)self.glow=ba;self.gRad=bb or self.gRad;self.scale=bc or false end;return self end;function Object(b8,aY,bd,aZ,be,bf,b4,b5)local t,x,w,bg=math.rad,system.print,math.random,getManager()local q=bg.getRotationManager;local aY=aY;local bh=bd;local b8=b8;local bi,bj,bk={},{},{}local be=be;local bf=bf;local a_={0,0,0,1}local bl=q(a_,aY)local bm={}local self={false,false,false,bi,false,bj,bk,be,bf,a_,b8,aY,bd,b4,b5,bm}function self.addDef(string)bm[#bm+1]=string end;function self.resetDefs()bm={}end;function self.setCustomSVGs(bn,b8,bc)local bo={}local bp={}local bq={b8,bo,bp}local bc=bc or 1;local br,bs=1,1;self[4][bn]=bq;local bd=bh;local bt,bu,bv=bd[1],bd[2],bd[3]local self={}function self.addMultiPointSVG()local bw={}local bx=nil;local by=nil;local self={}local bz=1;function self.addPoint(bA)local bA=bA;bw[bz]={bA[1]/bc+bt,bA[2]/bc-bu,bA[3]/bc-bv}bz=bz+1;return self end;function self.bulkSetPoints(bB)bw=bB;bz=#bw+1;return self end;function self.setData(bC)bx=bC;return self end;function self.setDrawFunction(bD)by=bD;return self end;function self.build()if bz>1 then if by~=nil then bo[br]={bw,by,bx}br=br+1;return bw else x("WARNING! Malformed multi-point build operation, no draw function specified. Ignoring.")end else x("WARNING! Malformed multi-point build operation, no points specified. Ignoring.")end end;return self end;function self.addSinglePointSVG()local self={}local bs=bs+1;local bE={false,false,false,false,false,false}bp[bs]=bE;function self.setPosition(aY)bE[2],bE[3],bE[4]=aY[1]/bc+bt,aY[2]/bc-bu,aY[3]/bc-bv;return self end;function self.setDrawFunction(bD)bE[5]=bD;return self end;function self.setData(bC)bE[6]=bC;return self end;function self.setEnabled(bF)bE[1]=bF;return self end;function self.build()bE[1]=true;return self end;return self end;return self end;function self.setUIElements(b8,bn)bn=bn or 1;local bG,l,D,bH,bI=math.sqrt,math.sin,math.cos,table.remove,table.unpack;local function bJ(bw,bK,bL,bM,bN)if#bw<3 then x("Invalid Point Set!")do return end end;return 2*(bK*bL-bM*bN),1-2*(bK*bK+bM*bM),2*(bL*bM+bK*bN)end;local function bO(bP,bQ)local bR=#bP;if bR>=60 then return false end;return{{bI(bP)},{bI(bQ)}}end;local bS={}local bT={}local bU={}local bV=false;local bq={b8,bS,bV,bT}self[6][bn]=bq;local self={}local bz,bW=0,0;local function bX(z,A,B)local bY={}local bZ={}local b_=math.huge;local c0,c1,c2,c3=-b_,b_,-b_,b_;local c4,c5={},{}local c6={false,false,false,false,false,false,false}local c7={0,0,0,1}local s={z,A+w()*0.000001,B}local c8=q(c7,s)local c9={false,false,false,c6,false,true,false,false,c4,c5,s,false,false,false,false,c7,c8}local ca={}local cb=bW+1;bS[cb]=c9;bW=cb;function bY.addSubElement(cc)local cd=#ca+1;if cc then ca[cd]=cc;c8.addSubRotation(cc.getRotationManager())end;return cd end;function bY.removeSubElement(cd)bH(ca,cd)end;function bY.getId()return cb end;function c9.getId()return cb end;local function ce(z,A)if z>c0 then c0=z end;if z<c1 then c1=z end;if A>c2 then c2=A end;if A<c3 then c3=A end end;function bY.addPoint(z,A)local bz=#pointSet+1;if z and A then ce(z,A)c4[bz]=z;c5[bz]=A else if type(z)=='table'and#z>0 then local z,A=z[1],z[2]ce(z,A)c4[bz]=z;c5[bz]=A else x('Invalid format for point.')end end end;function bY.addPoints(bw,cf)local cg,ch;if cf then cg,ch={},{}c9[9],c9[10]=cg,ch;c4,c5=cg,ch else cg,ch=c9[9],c9[10]c4,c5=cg,ch end;if bw then local ci=#bw;if ci>0 then local cj=type(bw[1])if cj=='number'then local ck=#cg;for aG=1,ci,2 do local cd=ck+aG;local z,A=bw[aG],bw[aG+1]ce(z,A)cg[cd]=z;ch[cd]=A end elseif cj=='table'then local ck=#cg;for aG=1,ci do local cd=ck+aG;local bA=bw[aG]local z,A=bA[1],bA[2]ce(z,A)cg[cd]=z;ch[cd]=A end else x('No compatible format found.')end end end end;function bY.getRotationManager()return c8 end;local function cl()if c9[15]then bY.setNormal(bJ(c4,c7[1],c7[2],c7[3],c7[4]))end end;c8.assignFunctions(bY,cl)local function cm()local cn=c9[2]if cn then if not c9[3]then c9[3]=c9[2]end;if not c9[1]then c9[1]=c9[2]end end end;local function co()c6[7]=true end;function bY.setHoverDraw(cp)c9[1]=cp;cm()end;function bY.setDefaultDraw(cq)c9[2]=cq;cm()end;function bY.setClickDraw(cr)c9[3]=cr;cm()end;function bY.setClickAction(cs)c6[1]=cs;co()end;function bY.setHoldAction(cs)c6[2]=cs;co()end;function bY.setEnterAction(cs)c6[3]=cs;co()end;function bY.setLeaveAction(cs)c6[4]=cs;co()end;function bY.setHoverAction(cs)c6[5]=cs;co()end;function bY.setIdentifier(ct)c6[6]=ct end;function bY.setScale(bc)c9[5]=bc end;function bY.getMaxValues()return c0,c1,c2,c3 end;function bY.hide()c9[6]=false end;function bY.show()c9[6]=true end;function bY.isShown()return c9[6]end;function bY.remove()bH(bS,cb)bH(bU,cb)for aG=cb,bW do bU[aG].setElementIndex(aG)end end;local cu,cv=0,0;function bY.move(cw,cx,cy,cz)if not cy then for aG=1,#pointSet do c4[aG]=c4[aG]-cu+cw;c5[aG]=c5[aG]-cv+cx end;c0,c1,c2,c3=c0+cw,c1+cw,c2+cx,c3+cx else for aG=1,#cy do local cd=cy[aG]c4[cd]=c4[cd]-cu+cw;c5[cd]=c5[cd]-cv+cx end end;cu=cw;cv=cx;if cz then bY.setBounds(bO(c4))end end;local cA,cB;function bY.moveTo(cw,cx,cy,cz,cC)if not cy then x('ERROR: No indices specified!')else if not cA then cA={table.unpack(c4)}cB={table.unpack(c5)}end;for aG=1,#cy do local cd=cy[aG]if not cC then c4[cd]=cw;c5[cd]=cx else c4[cd]=cA[cd]+cw;c5[cd]=cB[cd]+cx end end end;if cz then bY.setBounds(bO(c4,c5))end end;function bY.setDrawOrder(cy)local cD={}for aG=1,#cy do local cd=cy[aG]local cE=cD[cd]if not cE then cE={}cD[cd]=cE end;cE[#cE+1]=aG end;c9[7]=cD end;function bY.setDrawData(cF)c9[8]=cF end;function bY.getDrawData()return c9[8]end;function bY.setSizes(cG)if not c9[8]then c9[8]={['sizes']=cG}else c9[8].sizes=cG end end;function bY.getDrawOrder()return c9[7]end;function bY.getPoints()return c9[9],c9[10]end;function bY.setDrawOrder(cD)c9[7]=cD end;function bY.setDrawData(cF)c9[8]=cF end;function bY.setPoints(bP,bQ)if not bQ then bY.addPoints(bP,true)else c4,c5=bP,bQ;c9[9],c9[10]=bP,bQ end end;function bY.setElementIndex(cH)cb=cH end;function bY.getElementIndex(cH)return cb end;function bY.setNormal(cI,cJ,cK)c9[12]=cI;c9[13]=cJ;c9[14]=cK end;function bY.setBounds(cL)c9[15]=cL end;function bY.build(cM,cN)local cI,cJ,cK=bJ(c4,c7[1],c7[2],c7[3],c7[4])if cI then if c9[2]then bY.setNormal(cI,cJ,cK)if not cM then if cN or cN==nil then bY.setBounds(bO(c4,c5))else bY.setBounds(false)end end else x("Element Malformed: No default draw.")end else x("Element Malformed: Insufficient points.")end end;return bY,c9 end;function self.createText(aO,aP,aQ)local cO,cP,cQ=table.concat,string.byte,string.upper;local cR,cS=bX(aO,aP,aQ)local cT,cU,cV,cW={},{},0,''local cF={['sizes']={0.08333333333},'white',1}local cX,cY='middle','middle'local cZ=1;local c_,d0=0,0;local c0,c1,c2,c3=cR.getMaxValues()cR.setDrawData(cF)function cR.getMaxValues()return c0,c1,c2,c3 end;function cR.getText()return cW end;local function d1(d2)cW=d2;local d3={cP(cQ(d2),1,#d2)}cT={}for d4=1,#d3 do local d5=d3[d4]cT[d4]=b2[d5]end end;local function d6()cU={0}local d7=1;local d8,d9=0,0;local da=cF.sizes[1]/cZ;for d4=1,#cT do local db=cT[d4]if db[4]==10 then d9=d9+db[2]*da;if cX=="middle"then d8=-d8*0.5 elseif cX=="end"then d8=-d8 elseif cX=="start"then d8=0 end;cU[d7]=d8;d7=d7+1;d8=0 else d8=d8+db[2]*da end end;if cX=="middle"then d8=-d8*0.5 elseif cX=="end"then d8=-d8 elseif cX=="start"then d8=0 end;if cY=='middle'then d9=d9+12*da;cV=-d9*0.5 elseif cY=='top'then d9=d9+12*da;cV=-d9 elseif cY=='bottom'then cV=0 end;cU[d7]=d8 end;local function ce(z,A)if z>c0 then c0=z end;if z<c1 then c1=z end;if A>c2 then c2=A end;if A<c3 then c3=A end end;local function dc()local bu=cV;local dd,d7=cU[1],1;local da=cF.sizes[1]/cZ;local bP,bQ,de={},{},{'<path stroke-width="%gpx" stroke="%s" stroke-opacity="%g" fill="none" d="'}local df=1;local dg=#cT;for d4=1,dg do local db=cT[d4]de[d4+1]=db[3]local dh,di=db[1],db[2]for dj=1,#dh,2 do local z,A=dh[dj]*da+dd+c_,dh[dj+1]*da+bu+d0;ce(z,A)bP[df]=z;bQ[df]=A;df=df+1 end;dd=dd+di*da;if db[4]==10 then d7=d7+1;dd=cU[d7]bu=bu-di*da end end;de[dg+2]='"/>'local dk=cO(de)cR.setDefaultDraw(dk)cR.setClickDraw(dk)cR.setPoints(bP,bQ)end;function cR.setText(d2)d1(d2)d6()dc()end;function cR.setWeight(bc)local cG=cF.sizes;cG[1]=cG[1]/cZ;cZ=bc or cZ;cG[1]=cG[1]*cZ;if#cT>0 then dc()end end;local dl=cR.move;function cR.move(z,A)c_=c_+z;d0=d0+A;dl(z,A)end;function cR.setFontSize(bR)local cG=cF.sizes;cG[1]=bR*0.08333333333;if#cT>0 then d6()dc()end end;function cR.setAlignmentX(dm)cX=dm;if#cT>0 then d6()dc()end end;function cR.setAlignmentY(dn)cY=dn;if#cT>0 then d6()dc()end end;function cR.setFontColor(dp)cF[1]=dp end;function cR.setOpacity(dq)cF[2]=dq end;return cR,textTemplate end;function self.createButton(P,Q,R)local cR,dr=bX(P,Q,R)local ds;function cR.setText(d2,bK,bL,bM)bK,bL,bM=bK or 0,bL or-0.01,bM or 0;if not ds then ds=self.createText(P+bK,Q+bL,R+bM)cR.addSubElement(ds)else ds.setPosition(P+bK,Q+bL,R+bM)end;local c0,c1,c2,c3=cR.getMaxValues()local dt=c2-c3;local du=c0-c1;ds.setText(d2)local dv,dw,dx,dy=ds.getMaxValues()local dz=dx-dy;local dA=dv-dw;local dB,dC=dz/dt,dA/du;if dB<dC then local bR=dz/dC;ds.setFontSize(bR*0.75)else local bR=dz/dB;ds.setFontSize(bR*0.75)end;return ds end;return cR end;function self.createProgressBar(dD,dE,dF)local dG,dH=bX(dD,dE,dF)local dI,dJ=bX(0,0,0)dI.setPositionIsRelative(true)dG.addSubElement(dI)local dK={}local dL={}local dM={}local dN=100;function dG.getIntervals()return dM end;function dG.getProgress(a6)local bw=dI.getPoints()if a6 then local D=dM[1]local dO=D[1]local dP=(a6-bw[dK[1]])/dO;if dP<0 then return 0.001 elseif dP>100 then return 100 else return dP end end;return dN end;local function dQ()local dR=#dK;local dS=#dL;local bP,bQ=dI.getPoints()if#bP>0 then if dR==dS and dR>0 then for aG=1,dR do local dT=dK[aG]local dU=dL[aG]local dV=(bP[dU]-bP[dT])*0.01;local dW=(bQ[dU]-bQ[dT])*0.01;dM[aG]={dV,dW}end end end end;function dG.setStartIndices(cy)dK=cy;dQ()end;function dG.setEndIndices(cy)dL=cy;dQ()end;local dX=dG.addPoints;function dG.addPoints(bw)dX(bw)dQ()end;function dG.setProgress(dP)dN=dP or 0;if dN<0 then dN=0 end;if dN>100 then dN=100 end;local bP,bQ=dI.getPoints()for aG=1,#dL do local D=dM[aG]local dT=dK[aG]local dU=dL[aG]bP[dU]=bP[dT]+D[1]*dN;bQ[dU]=bQ[dT]+D[2]*dN end end;function dG.setFillPoints(bw)dI.addPoints(bw)end;function dG.getFillDrawData()return dI.getDrawData()end;function dG.setFillDrawData(cF)dI.setDrawData(cF)end;function dG.setFillDraw(bD)dI.setDefaultDraw(bD)end;function dG.setFillOffsetPosition(aO,aP,aQ)dI.setPosition(aO,aP,aQ)end;return dG end;self.createCustomDraw=bX;local dY=0;function self.create3DObject(z,A,B)local cR={}local pointSet={{},{},{},{}}local de={}local dZ={}local c6={false,false,false,false,false,false}local c9={is3D=true,false,false,false,c6,false,true,false,false,pointSet,z,A,B,dZ}local bW=dY+1;dY=bW;local dY=bW;bT[bW]=c9;function cR.addPoints(bw,d_)local e0,e1,e2,e3=pointSet[1],pointSet[2],pointSet[3],pointSet[4]local e4,e5=#e0,#bw;local e6=e4+e5;e0[e6]=false;e1[e6]=false;e2[e6]=false;for aG=e4+1,e6 do local e7=bw[aG]e0[aG]=e7[1]e1[aG]=e7[2]e2[aG]=e7[3]end end;function cR.setFaces(e8,e9,ea,eb)local cO,bH=table.concat,table.remove;local e0,e1,e2=pointSet[1],pointSet[2],pointSet[3]local function ec(ed)local ee=#ed;if ee>2 then local ef,eg,eh=ed[1],ed[2],ed[3]local ei,ej,ek,el,em,en,eo,ep,eq=e0[ef],e1[ef],e2[ef],e0[eg],e1[eg],e2[eg],e0[eh],e1[eh],e2[eh]local er,es,et=el-ei,em-ej,en-ek;local eu,ev,ew=eo-ei,ep-ej,eq-ek;local cI,cJ,cK=es*ew-et*ev,et*eu-er*ew,er*ev-eu*es;local ex=(cI*cI+cJ*cJ+cK*cK)^0.5;cI,cJ,cK=cI/ex,cJ/ex,cK/ex;local a6,pY,a7=ei+el+eo,ej+em+ep,ek+en+eq;local ey=nil;if ee==4 then local ez=ec({ed[4],ed[1],ed[3]})if not(ez[4]==cI and ez[5]==cJ and ez[6]==cK)then bH(ed,4)ey=ez end end;local df=3;local string={'<path color=rgb(%.f,%.f,%.f) d="M%.1f %.1fL%.1f %.1f %.1f %.1f'}local eA=2;for aG=4,#ed do local eB=ed[aG]a6,pY,a7=a6+e0[eB],pY+e1[eB],a7+e2[eB]df=df+1;string[eA]=' %.1f %.1f'eA=eA+1 end;string[eA]='Z"/>'return{a6/df,pY/df,a7/df,cI,cJ,cK,ed,e9,ea,eb,cO(string)},ey end end;local dj=1;for aG=1,#e8 do local bx,ey=ec(e8[aG])dZ[dj]=bx;dj=dj+1;if ey then dZ[dj]=ey;dj=dj+1 end end end;function cR.setScale()end;function cR.setDrawData(cF)c9[8]=cF end;return cR end;function self.createSlider(eC,eD)local self={}return self end;return self end;bl.assignFunctions(self)function self.addSubObject(b6)bl.addSubRotation(b6.getRotationManager())end;function self.removeSubObject(b7)self[6][b7]={}end;function self.setSubObjects()local self={}local D=1;function self.addSubObject(b6)self[6][D]=b6;D=D+1;return self end;return self end;return self end;function ObjectBuilderLinear()local self={}function self.setStyle(b8)local self={}local b8=b8;function self.setPosition(b0)local self={}local b0=b0;function self.setOffset(bd)local self={}local bd=bd;function self.setOrientation(aZ)local self={}local aZ=aZ;function self.setPositionType(be)local self={}local be=be;function self.setOrientationType(bf)local self={}local bf=bf;local b4,b5=nil,nil;function self.setTranslation(eE,eF)b4,b5=eE,eF;return self end;function self.build()return Object(b8,b0,bd,aZ,be,bf,b4,b5)end;return self end;return self end;return self end;return self end;return self end;return self end;return self end;function Projector(eG)local core,system,bg=core,system,getManager()local eH,eI,eJ,eK,eL,x=system.getScreenWidth,system.getScreenHeight,system.getFov,system.getMouseDeltaX,system.getMouseDeltaY,system.print;local eM,eN,eO,eP=core.getConstructWorldRight,core.getConstructWorldForward,core.getConstructWorldUp,core.getConstructWorldPos;local eQ=system.getCameraPos;local eR,eS,eT=system.getCameraForward,system.getCameraRight,system.getCameraUp;local a=bg.matrixToQuat;local eU=math;local u,v,eV,t,eW=eU.sin,eU.cos,eU.tan,eU.rad,eU.atan;local eX=system.getCameraVerticalFov;local eY=system.getCameraHorizontalFov;local eZ=0;local e_={}local self={objectGroups=e_}local f0=false;function self.getSize(bR,f1,f2,f3)local f4=eW(bR,f1)*eZ;local f2=f2 or f4;local f3=f3 or f4;if f4>=f2 then return f2 elseif f4<=f3 then return f3 else return f4 end end;function self.addObjectGroup(f5,b7)local cd=b7 or#e_+1;e_[cd]=f5;return cd end;function self.removeObjectGroup(b7)e_[b7]={}end;local cw,cx,f6,f7;function self.getModelMatrix(f8)local l,D=u,v;local f9={}local fa,fb=f8[10],f8[12]local fc,fd,fe=fb[1],fb[2],fb[3]if f8[9]==1 then local wx,wy,wz,ww=fa[1],fa[2],fa[3],fa[4]local cw,cx,f6,f7=a(cRX,cRY,cRZ,cFX,cFY,cFZ,cUX,cUY,cUZ)local c_,d0,ff,fg=wx*f7+ww*cw+wy*f6-wz*cx,wy*f7+ww*cx+wz*cw-wx*f6,wz*f7+ww*f6+wx*cx-wy*cw,ww*f7-wx*cw-wy*cx-wz*f6;wx,wy,wz,ww=c_,d0,ff,fg end;if f8[8]==2 then return fa[1],fa[2],fa[3],fa[4],fc,fd,fe else local fh=eP()local fi,fj,fk=fc-fh[1],fd-fh[2],fe-fh[3]return wx,wy,wz,ww,cRX*fi+cRY*fj+cRZ*fk,cFX*fi+cFY*fj+cFZ*fk,cUX*fi+cUY*fj+cUZ*fk end end;function self.getViewMatrix()local fl,fm,J=eO(),eN(),eM()cw,cx,f6,f7=a(J[1],J[2],J[3],fm[1],fm[2],fm[3],fl[1],fl[2],fl[3])local b7=eG.cType.id;local fn,fo=b7==0,b7==1;if fn or fo then local l,D=u,v;local fp=eG.orientation;local fq,fr,fs=fp[1]*0.5,-fp[2]*0.5,fp[3]*0.5;local E,G,F=l(fq),l(fr),l(fs)local H,J,I=D(fq),D(fr),D(fs)local ft,fu,fv,fw=E*J,E*G,H*G,H*J;if fo then wx,wy,wz,ww=ft,fu,fv,fw else local c_,d0,ff,fg=cw*fw+f7*ft+cx*fv-f6*fu,cx*fw+f7*fu+f6*ft-cw*fv,f6*fw+f7*fv+cw*fu-cx*ft,f7*fw-cw*ft-cx*fu-f6*fv;wx,wy,wz,ww=c_,d0,ff,fg end else local fx=eQ()local fy,fz,fA=fx[1],fx[2],fx[3]local fB,fC,fD=eR(),eS(),eT()local fE,fF,fG=fC[1],fC[2],fC[3]local fH,fI,fJ=fB[1],fB[2],fB[3]local fK,fL,fM=fD[1],fD[2],fD[3]return fE,fF,fG,fH,fI,fJ,fK,fL,fM,-(fE*fy+fF*fz+fG*fA),-(fH*fy+fI*fz+fJ*fA),-(fK*fy+fL*fz+fM*fA),fy,fz,fA end end;function self.getSVG(fN,fO)local fP=false;if clicked then clicked=false;fP=true end;local isHolding=isHolding;local fQ=fN or{}local fO=fO or 1;local fR,fS,fT,fU,fV,fW,fX,fY,fZ,f_,g0,g1,g2,g3,g4=self.getViewMatrix()local g5,g6,g7,g8=a(fR,fS,fT,fU,fV,fW,fX,fY,fZ)local eW,g9,ga,bI,cO,gb=eW,table.sort,string.format,table.unpack,table.concat,self.getModelMatrix;local gc=2;local gd,ge=eH()/gc,eI()/gc;local gf=gd/ge;local gg=eV(t(eY()*0.5))local function gh(gi,gj)return gi[1]>gj[1]end;local gk=gd/gg;eZ=gk;local gl=1/gg;local gm=gl*gf;local gn=gl*gd;local go=-gm*ge;local e_=e_;local gp={}local gq=1;for aG=1,#e_ do local f5=e_[aG]if f5.enabled==false then goto gr end;local gs=f5.transX or gd;local gt=f5.transY or ge;local b3=f5.objects;local gu,gv=0,0;local gw,gx,gy,gz,gA,gB={},{},{},{},0,0;local gC,gD,gE,gF={},{},1,1;local gG=true;for dj=1,#b3 do local gH=b3[dj]if gH[12]==nil then goto gI end;local c_,d0,ff,fg,gJ,gK,gL=gb(gH)local gM=gH[11]local gN,gO,gP,gQ=c_*g8+fg*g5+d0*g7-ff*g6,d0*g8+fg*g6+ff*g5-c_*g7,ff*g8+fg*g7+c_*g6-d0*g5,fg*g8-c_*g5-d0*g6-ff*g7;local gR,gS,gT=gN*gN,gO*gO,gP*gP;local gU,gV,gW,gX=(1-2*(gS+gT))*gn,2*(gN*gO+gP*gQ)*gn,2*(gN*gP-gO*gQ)*gn,(f_+fR*gJ+fS*gK+fT*gL)*gn;local gY,gZ,g_,h0=2*(gN*gO-gP*gQ),1-2*(gR+gT),2*(gO*gP+gN*gQ),g0+fU*gJ+fV*gK+fW*gL;local h1,h2,h3,h4=2*(gN*gP+gO*gQ)*go,2*(gO*gP-gN*gQ)*go,(1-2*(gR+gS))*go,(g1+fX*gJ+fY*gK+fZ*gL)*go;gu=gu+h0;gv=gv+1;local h5,h6,h7=g2-gJ,g3-gK,g4-gL;local bi,bj=gH[4],gH[6]for h8=1,#bi do local h9=bi[h8]local ha=h9[2]local hb=h9[3]for hc=1,#ha do local hd=ha[hc]local he=hd[1]local hf={}local hg=1;local hh=0;for bz=1,#he do local hi=he[bz]local z,A,B=hi[1],hi[2],hi[3]local hj=gY*z+gZ*A+g_*B+h0;if hj<0 then goto hk end;hf[hg]={(gU*z+gV*A+gW*B+gX)/hj,(h1*z+h2*A+h3*B+h4)/hj,hj}hh=hh+hj;hg=hg+1::hk::end;if hg~=1 then local by=hd[2]local bx=hd[3]gB=gB+1;local hl=hh/(hg-1)gx[gB]=hl;gw[hl]={hf,bx,by}end end;for hm=1,#hb do local hn=hb[hm]if not hn[1]then goto ho end;local z,A,B=hn[2],hn[3],hn[4]local hj=gY*z+gZ*A+g_*B+h0;if hj<0 then goto ho end;local by=hn[5]local bx=hn[6]gB=gB+1;gx[gB]=hj;gw[hj]={(gU*z+gV*A+gW*B+gX)/hj,(h1*z+h2*A+h3*B+h4)/hj,bx,by,isCustomSingle=true}::ho::end end;for hp=1,#bj do local hq=bj[hp]local bS=hq[2]local bT=hq[4]for bW=1,#bT do local hr=bT[bW]local hs,ht,hu=hr[10],hr[11],hr[12]local hv=hr[9]local bP,bQ,hw=hv[1],hv[2],hv[3]local hx,hy={},{}local bR=#bP;hx[bR]=false;hy[bR]=false;local hz=gU*hs+gV*ht+gW*hu+gX;local hA=gY*hs+gZ*ht+g_*hu+h0;local hB=h1*hs+h2*ht+h3*hu+h4;for cd=1,bR do local z,A,B=bP[cd],bQ[cd],hw[cd]local hj=gY*z+gZ*A+g_*B+hA;if hj>0 then hx[cd]=(gU*z+gV*A+gW*B+hz)/hj;hy[cd]=(h1*z+h2*A+h3*B+hB)/hj end end;local ax,ay,az=0.26726,0.80178,0.53452;local hC=0.3;local hD=hr[13]local hE=#hD;gx[gB+hE]=false;for hi=1,hE do local hF=hD[hi]local hG,hH,hI=hF[1]+hs,hF[2]+ht,hF[3]+hu;local hJ=gY*hG+gZ*hH+g_*hI+h0;if hJ<0 then goto hK end;local hL,hM,hN=h5-hG,h6-hH,h7-hI;local hO,hP,hQ=hF[4],hF[5],hF[6]local hR=hL*hO+hM*hP+hN*hQ;if hR<0 then goto hK end;local hS=ax*hO+ay*hP+az*hQ;if hS<0 then hS=hS*0.1*(1-hC)+hC else hS=hS*(1-hC)+hC end;local e9,ea,eb=hF[8]*hS,hF[9]*hS,hF[10]*hS;local cy=hF[7]local bx={e9,ea,eb}local dj=4;local hT=#cy;bx[dj+hT*2-1]=false;for aG=1,hT do local cd=cy[aG]local e0=hx[cd]if not e0 then goto hK end;bx[dj]=e0;bx[dj+1]=hy[cd]dj=dj+2 end;gB=gB+1;gx[gB]=hJ;gw[hJ]={hF[11],bx,is3D=true}::hK::end end;for bW=1,#bS do local hU=bS[bW]if not hU[6]then goto hK end;hU[17].checkUpdate()local hV=hU[11]local hG,hH,hI=hV[1],hV[2],hV[3]local hJ=gY*hG+gZ*hH+g_*hI+h0;if hJ<0 then goto hK end;local hW=gU*hG+gV*hH+gW*hI+gX;local hX=h1*hG+h2*hH+h3*hI+h4;local c6=hU[4]local hY=hU[16]local hZ=-hY[4]local h_,i0,i1,i2,i3,i4;if hZ~=-1 then local i5,i6,i7=hY[1],hY[2],hY[3]local bK,bL,bM,bN=i5*gQ+hZ*gN+i6*gP-i7*gO,i6*gQ+hZ*gO+i7*gN-i5*gP,i7*gQ+hZ*gP+i5*gO-i6*gN,hZ*gQ-i5*gN-i6*gO-i7*gP;local i8,i9,ia=bK*bK,bL*bL,bM*bM;h_,i0=(1-2*(i9+ia))*gn,2*(bK*bM-bL*bN)*gn;i1,i2=2*(bK*bL-bM*bN),2*(bL*bM+bK*bN)i3,i4=2*(bK*bM+bL*bN)*go,(1-2*(i8+i9))*go else h_,i0=gU,gW;i1,i2=gY,g_;i3,i4=h1,h3 end;gB=gB+1;if hU[15]and c6[7]then gA=gA+1;local hL,hM,hN=h5-hG,h6-hH,h7-hI;local hO,hP,hQ=hU[12],hU[13],hU[14]local k=-(hL*hO+hM*hP+hN*hQ)/(fU*hO+fV*hP+fW*hQ)local ib,ic,hj=hL+k*fU,hM+k*fV,hN+k*fW;local id,ie,ig,ih=hY[1],hY[2],hY[3],hY[4]local ii=ie*ie;gx[gB]=hJ;gw[hJ]={hU,false,hW,hX,h_,i0,i1,i2,i3,i4,isUI=true}gz[gA]=hJ;gy[hJ]={hU,2*((0.5-ii-ig*ig)*ib+(id*ie+ig*ih)*ic+(id*ig-ie*ih)*hj),2*((id*ig+ie*ih)*ib+(ie*ig-id*ih)*ic+(0.5-id*id-ii)*hj),c6}else gx[gB]=hJ;gw[hJ]={hU,false,hW,hX,h_,i0,i1,i2,i3,i4,isUI=true}end::hK::end end::gI::end;if gA>0 then if hoveringOverUIElement then hoveringOverUIElement=false end;local ij=false;g9(gz)for ik=1,gA do local f1=gz[ik]local il=gy[f1]local hU=il[1]local im=hU[2]local c6=hU[4]if gG then local io=hU[15]if io and c6[7]then local a6,a7=il[2],il[3]local ip=false;if type(io)=="function"then ip=io(a6,a7,f1)else local iq,ir=io[1],io[2]local is=#iq+1;local ei,ej=iq[1],ir[1]local bd=0;for it=2,is do local hr=it%is;if hr==0 then bd=1 end;local cd=hr+bd;local el,em=iq[cd],ir[cd]local c3,c2;if ej<em then c3,c2=ej,em else c3,c2=em,ej end;if a7>c3 and a7<=c2 then local c0=ei>el and ei or el;if a6<=c0 then if ej~=em then if ei==el or a6<=(a7-ej)*(el-ei)/(em-ej)+ei then ip=not ip end end end end;ei,ej=el,em end end;if not ip then goto iu end;gG=false;ij=il;local hV=hU[11]local ct=c6[6]if f0==false then local iv=c6[3]if iv then iv(ct,a6,a7)end elseif ij[6]==f0[6]then if fP then local iw=c6[1]if iw then iw(ct,a6,a7,hV[1],hV[2],hV[3])fP=false end;im=hU[3]elseif isHolding then local ix=c6[2]if ix then hovered=true;ix(ct,a6,a7,hV[1],hV[2],hV[3])end;im=hU[3]else local iy=c6[5]if iy then hoveringOverUIElement=true;hovered=true;iy(ct,a6,a7,hV[1],hV[2],hV[3])end;im=hU[1]end else local iv=c6[3]if iv then iv(ct,a6,pY)end;local iz=f0[4][4]if iz then iz(ct,a6,pY)end end::iu::end end;gw[f1][2]=im end;if ij==false and f0 then local iz=f0[4][4]if iz then iz()end end;f0=ij end;g9(gx)for iA=gB,1,-1 do local iB=gx[iA]local il=gw[iB]if il.isUI then local hU=il[2]local hU,im,hz,hB,h_,i0,i1,i2,i3,i4=bI(il)if not im then im=hU[2]if not im then goto iC end end;local hA=iB;local df=1;local bc=hU[5]or 1;local cD=hU[7]local cF=hU[8]local bP,bQ=hU[9],hU[10]local iD=gE;if cF then local cG=cF["sizes"]if cG then gE=gE+#cG end;gE=gE+#cF end;local iC=false;if not cD then for iE=1,#bP do local dD,dF=bP[iE]*bc,bQ[iE]*bc;local hj=i1*dD+i2*dF+hA;if hj<0 then gE=iD;goto iC end;iB=iB+hj;df=df+1;gC[gE]=(h_*dD+i0*dF+hz)/hj;gC[gE+1]=(i3*dD+i4*dF+hB)/hj;gE=gE+2 end else for iE=1,#bP do local dD,dF=bP[iE]*bc,bQ[iE]*bc;local hj=i1*dD+i2*dF+hA;if hj<0 then gE=iD;goto iC end;iB=iB+hj;df=df+1;local ib=(h_*dD+i0*dF+hz)/hj;local ic=(i3*dD+i4*dF+hB)/hj;local iF=cD[iE]or{}for aG=1,#iF do local cd=iF[aG]+gE-1;gC[cd]=ib;gC[cd+1]=ic end end end;mUC=gE;gE=iD;local iG=iB/df;if cF then local cG=cF["sizes"]if cG then for aG=1,#cG do local bR=cG[aG]local iH=type(bR)if iH=="number"then gC[gE]=eW(bR,iG)*gk elseif iH=="function"then gC[gE]=bR(iG,gk)end;gE=gE+1 end end;for iI=1,#cF do gC[gE]=cF[iI]gE=gE+1 end end;gD[gF]=im;gF=gF+1;gE=mUC::iC::elseif il.is3D then local bx=il[2]for iJ=1,#bx do gC[gE]=bx[iJ]gE=gE+1 end;gD[gF]=il[1]gF=gF+1 elseif il.isCustomSingle then local z,A,bx,by=il[1],il[2],il[3],il[4]local iK=#gC;gD[gF]=by(z,A,iB,bx,gC,gE)or'<text x=0 y=0>Error: N-CS</text>'gF=gF+1;local iL=#gC;if iK~=iL then gE=iL+1 end else local bw,bx,by=il[1],il[2],il[3]local iK=#gC;gD[gF]=by(bw,bx,gC,gE)gF=gF+1;local iL=#gC;if iK~=iL then gE=iL+1 end end end;local iM={ga('<svg viewbox="-%g -%g %g %g">',gs,gt,gd*2,ge*2),ga('<style> svg{width:%gpx;height:%gpx;position:absolute;top:0px;left:0px;} %s </style>',gd*gc,ge*gc,f5.style),ga(cO(gD),bI(gC)),'</svg>'}if gv>0 then local iN=gu/gv;gp[gq]={iN,cO(iM)}gq=gq+1;if f5.glow then local bR;if f5.scale then bR=eW(f5.gRad,iN)*gk else bR=f5.gRad end;iM[1]=ga('<svg viewbox="-%g -%g %g %g" class="blur">',gs,gt,gd*2,ge*2)iM[2]=[[
                        <style> 
                            .blur {
                                filter: blur(]]..bR..[[px) 
                                        brightness(60%)
                                        saturate(3);
                                ]]..f5.gStyle..[[
                            }
                        </style>]]gp[gq]={iN+0.1,cO(iM)}gq=gq+1 end end::gr::end;g9(gp,gh)local iO=#gp;if iO>0 then fO=fO-1;for iP=1,iO do fQ[fO+iP]=gp[iP][2]end end;return fQ,fO+iO+1 end;return self end