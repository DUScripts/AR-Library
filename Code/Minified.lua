function getManager()local self={}local a=library.systemResolution3;local b,c,d,e,f=math.sqrt,math.atan,math.asin,math.acos,system.print;local g,h,i,j,k,l,m,n,o=core.getConstructWorldOrientationRight,core.getConstructWorldOrientationForward,core.getConstructWorldOrientationUp,core.getConstructOrientationRight,core.getConstructOrientationForward,core.getConstructOrientationUp,core.getConstructWorldRight,core.getConstructWorldForward,core.getConstructWorldUp;local p,q=nil,nil;function self.getLocalToWorldConverter()local r=a;local s,t,u=m(),n(),o()local v={s[1],t[1],u[1]}local w={s[2],t[2],u[2]}local x={s[3],t[3],u[3]}return function(y)return r(v,w,x,y)end end;function self.getWorldToLocalConverter()local A,B,C=m(),n(),o()local r=a;return function(D)return a(A,B,C,D)end end;function self.quatToAxisAngle(E,F,G,H)local I=1/b(1-H*H)return E*I,F*I,G*I,2*e(H)end;local function J(K,L,M,N,O,P,Q,R,S)local T=K+O+S;if T>0 then local r=0.5/b(T+1)return(P-R)*r,(Q-M)*r,(L-N)*r,0.25/r elseif K>O and K>S then local r=2*b(1+K-O-S)return 0.25*r,(N+L)/r,(Q+M)/r,(P-R)/r elseif O>S then local r=2*b(1+O-K-S)return(N+L)/r,0.25*r,(R+P)/r,(Q-M)/r else local r=2*b(1+S-K-O)return(Q+M)/r,(R+P)/r,0.25*r,(L-N)/r end end;function self.getPlayerLocalRotation()local U=unit.getMasterPlayerForward()local V=unit.getMasterPlayerRight()local W=unit.getMasterPlayerUp()return J(V[1],V[2],V[3],U[1],U[2],U[3],W[1],W[2],W[3])end;function self.rotMatrixToQuat(X)return J(X[1],X[5],X[9],X[2],X[6],X[10],X[3],X[7],X[11])end;function self.inverse(Y,Z,_,a0)return-Y,-Z,-_,a0 end;function self.inverseMulti(E,F,G,H,a1,a2,a3,a4)local a5,a6,a7,I=E*E,F*F,G*G,H*H;return a1*(I-a5-a6-a7)+2*H*(E*a4+F*a3-G*a2),2*(a1*(H*G+E*F)+a3*(F*G-H*E))+a2*(I-a5+a6-a7),2*(a1*(E*G-H*F)+a2*(E*H+F*G))+a3*(I-a5-a6+a7),a4*(I+a5+a6+a7)end;function self.transPoint3D(E,F,G,H,a1,a2,a3)local a5,a6,a7,I=E*E,F*F,G*G,H*H;return 2*(a2*(E*F-H*G)+a3*(E*G+H*F))+a1*(I+a5-a6-a7),2*(a1*(H*G+E*F)+a3*(F*G-H*E))+a2*(I-a5+a6-a7),2*(a1*(E*G-H*F)+a2*(E*H+F*G))+a3*(I-a5-a6+a7)end;function self.transPoints3D(E,F,G,H,a8)local a5,a6,a7,I=E*E,F*F,G*G,H*H;local a9,aa,y=I+a5-a6-a7,2*(E*F-H*G),2*(E*G+H*F)local ab,t,ac=2*(H*G+E*F),I-a5+a6-a7,2*(F*G-H*E)local ad,ae,af=2*(E*G-H*F),2*(E*H+F*G),I-a5-a6+a7;local ag={}for af=1,#a8,3 do local ah,ai,z=a8[af],a8[af+1],a8[af+2]ag[af]=ah*a9+ai*aa+z*y;ag[af+1]=ah*ab+ai*ac+z*t;ag[af+2]=ah*ad+ai*ae+z*af end;return ag end;function self.transPoints2D(E,F,G,H,a8)local a5,a6,a7,I=E*E,F*F,G*G,H*H;local aa,y=2*(E*G+H*F),I+a5-a6-a7;local ab,ac=2*(H*G+E*F),2*(F*G-H*E)local ad,af=2*(E*G-H*F),I-a5-a6+a7;local ag={}for af=1,#a8,3 do local ah,z=a8[af],a8[af+2]ag[af]=ah*y+z*aa;ag[af+1]=ah*ab+z*ac;ag[af+2]=ah*ad+z*af end;return ag end;function self.transPoint2D(E,F,G,H,ah,ai)local a5,a6,a7,I=E*E,F*F,G*G,H*H;return 2*z*(E*G+H*F)+ah*(I+a5-a6-a7),2*(ah*(H*G+E*F)+z*(F*G-H*E)),2*ah*(E*G-H*F)+z*(I-a5-a6+a7)end;function self.multiply(E,F,G,H,a1,a2,a3,a4)return E*a4+H*a1+F*a3-G*a2,F*a4+H*a2+G*a1-E*a3,G*a4+H*a3+E*a2-F*a1,H*a4-E*a1-F*a2-G*a3 end;p,q=self.getWorldToLocalConverter,self.getLocalToWorldConverter;return self end;positionTypes={globalP=1,localP=2}orientationTypes={globalO=1,localO=2}textAlignments={["middle"]='middle',["end"]='end',["start"]='start'}local f=system.print;local aj={[10]={{},{},16,''},[32]={{},{},10,''},[33]={{4,0,3,2,5,2,4,0,4,4,4,12},{1,2,3,4,false,5,6},6,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[34]={{2,10,2,6,6,10,6,6},{1,2,false,3,4},6,'M%g %gL%g %g M%g %gL%g %g'},[35]={{0,4,8,4,6,2,6,10,8,8,0,8,2,10,2,2},{1,2,false,3,4,false,5,6,false,7,8},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g'},[36]={{6,2,2,6,6,10,4,12,4,0},{1,2,3,false,4,5},6,'M%g %gL%g %gL%g %g M%g %gL%g %g'},[37]={{0,0,8,12,2,10,2,8,6,4,6,2},{1,2,false,3,4,false,5,6},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g'},[38]={{8,0,4,12,8,8,0,4,4,0,8,4},{1,2,3,4,5,6},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[39]={{0,8,0,12},{1,2},2,'M%g %gL%g %g'},[40]={{6,0,2,4,2,8,6,12},{1,2,3,4},6,'M%g %gL%g %gL%g %gL%g %g'},[41]={{2,0,6,4,6,8,2,12},{1,2,3,4},6,'M%g %gL%g %gL%g %gL%g %g'},[42]={{0,0,4,12,8,0,0,8,8,8,0,0},{1,2,3,4,5,6},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[43]={{1,6,7,6,4,9,4,3},{1,2,false,3,4},8,'M%g %gL%g %g M%g %gL%g %g'},[44]={{-1,-2,1,1},{1,2},4,'M%g %gL%g %g'},[45]={{2,6,6,6},{1,2},6,'M%g %gL%g %g'},[46]={{0,0,1,0},{1,2},3,'M%g %gL%g %g'},[47]={{0,0,8,12},{1,2},10,'M%g %gL%g %g'},[48]={{0,0,8,0,8,12,0,12,0,0,8,12},{1,2,3,4,5,6},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[49]={{2,0,2,12,0,10},{1,2,3},6,'M%g %gL%g %gL%g %g'},[50]={{0,12,8,12,8,7,0,5,0,0,8,0},{1,2,3,4,5,6},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[51]={{0,12,8,12,8,0,0,0,0,6,8,6},{1,2,3,4,false,5,6},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[52]={{0,12,0,6,8,6,8,12,8,0},{1,2,3,false,4,5},10,'M%g %gL%g %gL%g %g M%g %gL%g %g'},[53]={{0,0,8,0,8,6,0,7,0,12,8,12},{1,2,3,4,5,6},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[54]={{0,12,0,0,8,0,8,5,0,7},{1,2,3,4,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g'},[55]={{0,12,8,12,8,6,4,0},{1,2,3,4},10,'M%g %gL%g %gL%g %gL%g %g'},[56]={{0,0,8,0,8,12,0,12,0,6,8,6},{1,2,3,4,1,false,5,6},10,'M%g %gL%g %gL%g %gL%g %gZ M%g %gL%g %g'},[57]={{8,0,8,12,0,12,0,7,8,5},{1,2,3,4,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g'},[58]={{4,9,4,7,4,5,4,3},{1,2,false,3,4},2,'M%g %gL%g %g M%g %gL%g %g'},[59]={{4,9,4,7,4,5,1,2},{1,2,false,3,4},5,'M%g %gL%g %g M%g %gL%g %g'},[60]={{6,0,2,6,6,12},{1,2,3},6,'M%g %gL%g %gL%g %g'},[61]={{1,4,7,4,1,8,7,8},{1,2,false,3,4},8,'M%g %gL%g %g M%g %gL%g %g'},[62]={{2,0,6,6,2,12},{1,2,3},6,'M%g %gL%g %gL%g %g'},[63]={{0,8,4,12,8,8,4,4,4,1,4,0},{1,2,3,4,false,5,6},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[64]={{8,4,4,0,0,4,0,8,4,12,8,8,4,4,3,6},{1,2,3,4,5,6,7,8},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[65]={{0,0,0,8,4,12,8,8,8,0,0,4,8,4},{1,2,3,4,5,false,6,7},10,'M%g %gL%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[66]={{0,0,0,12,4,12,8,10,4,6,8,2,4,0},{1,2,3,4,5,6,7,1},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %gZ'},[67]={{8,0,0,0,0,12,8,12},{1,2,3,4},10,'M%g %gL%g %gL%g %gL%g %g'},[68]={{0,0,0,12,4,12,8,8,8,4,4,0},{1,2,3,4,5,6,1},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gZ'},[69]={{8,0,0,0,0,12,8,12,0,6,6,6},{1,2,3,4,false,5,6},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[70]={{0,0,0,12,8,12,0,6,6,6},{1,2,3,false,4,5},10,'M%g %gL%g %gL%g %g M%g %gL%g %g'},[71]={{6,6,8,4,8,0,0,0,0,12,8,12},{1,2,3,4,5,6},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[72]={{0,0,0,12,0,6,8,6,8,12,8,0},{1,2,false,3,4,false,5,6},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g'},[73]={{0,0,8,0,4,0,4,12,0,12,8,12},{1,2,false,3,4,false,5,6},10,'M%g %gL%g %g M%g %gL%g %g M%g %gL%g %g'},[74]={{0,4,4,0,8,0,8,12},{1,2,3,4},10,'M%g %gL%g %gL%g %gL%g %g'},[75]={{0,0,0,12,8,12,0,6,6,0},{1,2,false,3,4,5},10,'M%g %gL%g %g M%g %gL%g %gL%g %g'},[76]={{8,0,0,0,0,12},{1,2,3},10,'M%g %gL%g %gL%g %g'},[77]={{0,0,0,12,4,8,8,12,8,0},{1,2,3,4,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g'},[78]={{0,0,0,12,8,0,8,12},{1,2,3,4},10,'M%g %gL%g %gL%g %gL%g %g'},[79]={{0,0,0,12,8,12,8,0},{1,2,3,4,1},10,'M%g %gL%g %gL%g %gL%g %gZ'},[80]={{0,0,0,12,8,12,8,6,0,5},{1,2,3,4,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g'},[81]={{0,0,0,12,8,12,8,4,4,4,8,0},{1,2,3,4,1,false,5,6},10,'M%g %gL%g %gL%g %gL%g %gZ M%g %gL%g %g'},[82]={{0,0,0,12,8,12,8,6,0,5,4,5,8,0},{1,2,3,4,5,false,6,7},10,'M%g %gL%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[83]={{0,2,2,0,8,0,8,5,0,7,0,12,6,12,8,10},{1,2,3,4,5,6,7,8},10,'M%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %gL%g %g'},[84]={{0,12,8,12,4,12,4,0},{1,2,false,3,4},10,'M%g %gL%g %g M%g %gL%g %g'},[85]={{0,12,0,2,4,0,8,2,8,12},{1,2,3,4,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g'},[86]={{0,12,4,0,8,12},{1,2,3},10,'M%g %gL%g %gL%g %g'},[87]={{0,12,2,0,4,4,6,0,8,12},{1,2,3,4,5},10,'M%g %gL%g %gL%g %gL%g %gL%g %g'},[88]={{0,0,8,12,0,12,8,0},{1,2,false,3,4},10,'M%g %gL%g %g M%g %gL%g %g'},[89]={{0,12,4,6,8,12,4,6,4,0},{1,2,3,false,4,5},10,'M%g %gL%g %gL%g %g M%g %gL%g %g'},[90]={{0,12,8,12,0,0,8,0,2,6,6,6},{1,2,3,4,false,5,6},10,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[91]={{6,0,2,0,2,12,6,12},{1,2,3,4},6,'M%g %gL%g %gL%g %gL%g %g'},[92]={{0,12,8,0},{1,2},10,'M%g %gL%g %g'},[93]={{2,0,6,0,6,12,2,12},{1,2,3,4},6,'M%g %gL%g %gL%g %gL%g %g'},[94]={{2,6,4,12,6,6},{1,2,3},6,'M%g %gL%g %gL%g %g'},[95]={{0,0,8,0},{1,2},10,'M%g %gL%g %g'},[96]={{2,12,6,8},{1,2},6,'M%g %gL%g %g'},[123]={{6,0,4,2,4,10,6,12,2,6,4,6},{1,2,3,4,false,5,6},6,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[124]={{4,0,4,5,4,6,4,12},{1,2,false,3,4},6,'M%g %gL%g %g M%g %gL%g %g'},[125]={{4,0,6,2,6,10,4,12,6,6,8,6},{1,2,3,4,false,5,6},6,'M%g %gL%g %gL%g %gL%g %g M%g %gL%g %g'},[126]={{0,4,2,8,6,4,8,8},{1,2,3,4},10,'M%g %gL%g %gL%g %gL%g %g'}}function Text(string,ak,al,am)al=al or'middle'am=am or'middle'local self={}local an,ao=string.byte,string.upper;local ap={}local aq=ak*0.05 or 0.05;local ar=0;local as=0;local at={aq,"#0F0"}local a8={}function self.setFontSize(ak)aq=ak*0.05;at[1]=ak*0.05 end;function self.setCharacters(au)ap={}local av={an(ao(au),1,#au)}local aw=0;local ax=aj[10]ar=0;as=0;for ay=1,#av do aw=aw+1;local a8={}local az=av[ay]local aA=av[ay+1]or 10;local aB,aC=aj[az],aj[aA][3]local aD,aE,aF=aB[1],aB[2],aB[3]local aG=1;local aH=aF;for aI=1,#aD,2 do a8[aG]=aD[aI]*aq+ar;a8[aG+1]=0;a8[aG+2]=aD[aI+1]*aq+as;aG=aG+3 end;ar=ar+aH*aq;if az==10 then ar=0;as=as-aH*aq end;ap[aw]={a8,aE,aB[4]}end end;self.setCharacters(string)function self.getDrawStrings()local aJ=table.concat;local aK=ap;local aL={'<path stroke-width="%gpx" stroke="%s" fill="none" d="'}local y=2;for af=1,#aK do local aB=aK[af]local aM=aB[2]local aN=#aM-1;if aN==-1 then goto aO end;aL[y]=aB[3]y=y+1::aO::end;aL[y]='"/>'return at,aJ(aL)end;function self.getPoints()local aK=ap;local drawOrder={}local a8={}local aP=0;local aQ=0;if al=="middle"then aP=-ar*0.5 elseif al=="end"then aP=-ar end;if am=="middle"then if as==0 then aQ=-5*aq else aQ=-as*0.5 end elseif am=="end"then aQ=-as end;local aR=1;local aS=0;local aT=1;for af=1,#aK do local aB=aK[af]local aD=aB[1]local aU=aB[2]local aV=0;for aI=1,#aU do local aW=aU[aI]if not(aW==true or aW==false)and(aW~=1 or aW==1 and aI==1)then local aX=drawOrder[aW*3-2+aS]if not aX then aX={}drawOrder[aW*3-2+aS]=aX end;aX[#aX+1]=aT;aT=aT+2 end end;for ay=1,#aD,3 do a8[aR]=aD[ay]+aP;a8[aR+1]=aD[ay+1]a8[aR+2]=aD[ay+2]+aQ;aR=aR+3;aS=aS+3 end end;return drawOrder,a8 end;return self end;local function aY(aZ,a_,b0)aZ=aZ*0.5;a_=a_*0.5;b0=b0*0.5;local r,y=math.sin,math.cos;local b1,b2,b3=r(aZ),r(a_),r(b0)local b4,b5,b6=y(aZ),y(a_),y(b0)return b1*b5*b6-b4*b2*b3,b4*b2*b6+b1*b5*b3,b4*b5*b3-b1*b2*b6,b4*b5*b6+b1*b2*b3 end;local function b7(E,F,G,H,a8)local a5,a6,a7,I=E*E,F*F,G*G,H*H;local b8,b9,ba=I+a5-a6-a7,2*(E*F-H*G),2*(E*G+H*F)local bb,bc,bd=2*(H*G+E*F),I-a5+a6-a7,2*(F*G-H*E)local be,bf,bg=2*(E*G-H*F),2*(E*H+F*G),I-a5-a6+a7;local ag={}for af=1,#a8,3 do local ah,ai,z=a8[af],a8[af+1],a8[af+2]ag[af]=ah*b8+ai*b9+z*ba;ag[af+1]=ah*bb+ai*bc+z*bd;ag[af+2]=ah*be+ai*bf+z*bg end;return ag end;function ObjectGroup(bh,bi,bj,bk)local bi=bi or{}local self={style=bh,objects=bi,transX=bj,transY=bk,enabled=true}function self.addObject(bl,bm)local bm=bm or#bi+1;bi[bm]=bl;return bm end;function self.removeObject(bm)bi[bm]={}end;function self.hide()self.enabled=false end;function self.show()self.enabled=true end;function self.isEnabled()return self.enabled end;return self end;function Object(bh,bn,aV,bo,bp,bq,bj,bk)local br,f=math.rad,system.print;local bn=bn;local bs=aV;local b0=br(bo[1])local aZ=br(bo[2])local a_=br(bo[3])local bh=bh;local bt,bu,bv,bw,bx,by,bz={},{},{},{},{},{},{}local bp=bp;local bq=bq;local self={bt,bu,bv,bw,bx,by,bz,bp,bq,{aZ,b0,a_},bh,bn,aV,bj,bk}function self.setPolylines(bA,bh,a8,bB)local bC={bh}local bB=bB or 1;local aV=bs;local ar,as,bD=aV[1],aV[2],aV[3]for af=2,#a8+1 do local bE=a8[af-1]local bF={}local bG=1;for ay=1,#bE,3 do bF[bG]={bE[ay]/bB+ar,bE[ay+1]/bB-as,bE[ay+2]/bB-bD}bG=bG+1 end;bC[af]=bF end;self[1][bA]=bC end;function self.setCircles(bA,bh,bB)local bC={bh}local bB=bB or 1;local y=2;self[2][bA]=bC;local aV=aV or bs;local ar,as,bD=aV[1],aV[2],aV[3]local self={}function self.addCircle(bn,bH,bI)local self={}local bn={bn[1]/bB+ar,bn[2]/bB-as,bn[3]/bB-bD}local bJ,bK,bL,ak,bM,bN=nil,nil,nil,nil,false,nil;function self.setLabel(bO,bP,r,bQ,bR)bJ=bO;bK=bQ or 0;bL=bR or 0;ak=r or 10;bM=bP or false;return self end;function self.setActionFunction(actionFunction)bN=actionFunction;return self end;function self.build()local bS={bn,bH,bI,bJ,bK,bL,ak,bM,actionFunction}bC[y]=bS;y=y+1;return bS,y end;return self end;return self end;function self.setCurves(bA,bh,bB)local bB=bB or 1;local bT={}local bC={bh,bT}local aV=bs;local ar,as,bD=aV[1],aV[2],aV[3]self[3][bA]=bC;local self={}local y=1;function self.circleBuilder()local self={}function self.createCircle(bU,bH)local ay=0.5522847498307933984023;local bH=bH/bB;local bV,bW,bX=bU[1]/bB+ar,bU[2]/bB-as,bU[3]/bB-bD;local bY={{bV,bH+bW,bX},{bH*ay+bV,bH+bW,bX},{bH+bV,bH*ay+bW,bX},{bH+bV,bW,bX},{bH+bV,-bH*ay+bW,bX},{bH*ay+bV,-bH+bW,bX},{bV,-bH+bW,bX},{-bH*ay+bV,-bH+bW,bX},{-bH+bV,-bH*ay+bW,bX},{-bH+bV,bW,bX},{-bH+bV,bH*ay+bW,bX},{-bH*ay+bV,bH+bW,bX}}local bM,ak=false,10;local bZ={nil,bM,ak}local self={}function self.setLabel(bJ,bM,ak)local bM=bM or false;local ak=ak*0.002 or 0.05;bZ={bJ,bM,ak}return self end;function self.build()local b_={1,bY,bZ}bT[y]=b_;y=y+1;return b_,y end;return self end;return self end;function self.bezierBuilder()local self={}function self.createCurve(b1)end;function self.addControlPoint(b4)end;function self.addEndPoint(c0)end;return self end;return self end;function self.setCustomSVGs(bA,bh,bB)local c1={}local c2={}local bC={bh,c1,c2}local bB=bB or 1;local c3,c4=1,1;self[4][bA]=bC;local aV=bs;local ar,as,bD=aV[1],aV[2],aV[3]local self={}function self.addMultiPointSVG()local a8={}local c5=nil;local c6=nil;local self={}local c7=1;function self.addPoint(c8)local c8=c8;a8[c7]={c8[1]/bB+ar,c8[2]/bB-as,c8[3]/bB-bD}c7=c7+1;return self end;function self.bulkSetPoints(c9)a8=c9;c7=#a8+1;return self end;function self.setData(dat)c5=dat;return self end;function self.setDrawFunction(ca)c6=ca;return self end;function self.build()if c7>1 then if c6~=nil then c1[c3]={a8,c6,c5}c3=c3+1;return a8 else f("WARNING! Malformed multi-point build operation, no draw function specified. Ignoring.")end else f("WARNING! Malformed multi-point build operation, no points specified. Ignoring.")end end;return self end;function self.addSinglePointSVG()local c8,c6,c5=nil,nil,nil;local self={}function self.setPosition(bn)c8={bn[1]/bB+ar,bn[2]/bB-as,bn[3]/bB-bD}return self end;function self.setDrawFunction(ca)c6=ca;return self end;function self.setData(dat)c5=dat;return self end;function self.build()if c8~=nil then if c6~=nil then c2[c4]={c8,c6,c5}c4=c4+1 else f("WARNING! Malformed single point build operation, no draw function specified. Ignoring.")end else f("WARNING! Malformed single point build operation, no point specified. Ignoring.")end end;return self end;return self end;function self.setUIElements(bA,bh,bB)local b,r,y,cb=math.sqrt,math.sin,math.cos,table.remove;local function cc(a8)if#a8<9 then f("Invalid Point Set!")do return end end;local cd,ce,cf,cg,ch,ci,cj,ck,cl=a8[1],a8[2],a8[3],a8[4],a8[5],a8[6],a8[7],a8[8],a8[9]local cm,cn,co=cd-cg,ce-ch,cf-ci;local cp,cq,cr=cd-cj,ce-ck,cf-cl;local cs,ct,cu,cv=cn*cr-co*cq,co*cp-cm*cr,cm*cq-cn*cp;local cw=1/b(cs*cs+ct*ct+cu*cu)return cs*cw,ct*cw,cu*cw end;local function cx(a8)local cy={}local ak=#a8;if ak>=60 then return false end;for af=1,ak-3,3 do local cd,ce,cg,ch=a8[af],a8[af+2],a8[af+3],a8[af+5]cy[af]=ce-ch;cy[af+1]=cd-cg;cy[af+2]=cd*ch-cg*ce end;local cd,ce,cg,ch=a8[ak-2],a8[ak],a8[1],a8[3]local cz=ak-2;cy[cz]=ce-ch;cy[cz+1]=cd-cg;cy[cz+2]=cd*ch-cg*ce;return cy end;local cA={}local cB={}local bC={bh,cA}local bB=bB or 1;self[6][bA]=bC;local aZ,a_,cC=0,0,0;local self={}local c7,cD=0,0;local cE,cF,cG,cH=aY(0,0,0)local cI,cJ,cK=0,0,0;function self.setReferencePoint(ah,ai,z)for af=1,cD do local cL=cB[af]cL.setPosition(cL.get)end;cI,cJ,cK=ah,ai,z end;local function cM(ah,ai,z,aV)local cN={}local cO={}local cP=ah+cI;local cQ=ai+cJ;local cR=z+cK;local cS=0;local cT=cD+1+(aV or 0)local cU={}local cV={}local cW={false,false,false,false,false,true,false,false,cU,cP,cQ,cR}local cE,cF,cG,cH=aY(0,0,0)local cX,cY,cZ=0,0,0;local c_={user=cN,raw=cO}function cN.rotateXYZ(d0,d1,d2)if d0 and d1 and d2 then cX=d0;cY=d1;cZ=d2;rotate()else f('Invalid format. Must be three angles. Use radians.')end end;function cN.addPoint(ah,ai,z)if ah and ai and z then cV[cS+1]=ah;cV[cS+2]=ai;cV[cS+3]=z;cS=cS+3 else if type(ah)=='table'and#ah>0 then cV[cS+1]=ah[1]cV[cS+2]=ah[2]cV[cS+3]=ah[3]cS=cS+3;return cS else f('Invalid format for point.')end end end;function cN.addPoints(a8)if a8 then local d3=#a8;if d3>0 then local d4=type(a8[1])if d4=='number'then local d5=cV;local d6=cS+1;local d7={}local y=1;for af=1,d3,3 do local aW=d6+af;d5[aW]=a8[af]d5[aW+1]=a8[af+1]d5[aW+2]=a8[af+2]d7[y]=aW;y=y+1 end;cS=#d5;return d7 elseif d4=='table'then local d5=cV;local d6=cS+1;local d7={}local y=1;local d8=0;for af=1,d3 do local c8=a8[af]local aW=d6+d8;d5[aW]=c8[1]d5[aW+1]=c8[2]d5[aW+2]=c8[3]d7[y]=aW;y=y+1;d8=d8+3 end;cS=#d5;return d7 else f('No compatible format found.')end end end end;local function rotate()cE,cF,cG,cH=aY(cX,cY,cZ)cU=b7(cE,cF,cG,cH,cV)cW[9]=cU;cW[17]=-cE;cW[18]=-cF;cW[19]=-cG;cW[20]=cH end;function cN.rotateX(d0)cX=d0;rotate()end;function cN.rotateY(d1)cY=d1;rotate()end;function cN.rotateZ(d2)cZ=d2;rotate()end;function cN.setHoverDraw(d9)cW[1]=d9 end;function cN.setDefaultDraw(da)cW[2]=da end;function cN.setClickDraw(db)cW[3]=db end;function cN.setClickAction(dc)cW[4]=dc end;function cN.setHoverAction(dd)cW[5]=dd end;function cN.hide()cW[6]=false end;function cN.show()cW[6]=true end;function cN.remove()cb(cA,cT)cb(cB,cT)for af=cT,cD do cB[af].raw.setElementIndex(af)end end;function cN.movePoints(cm,cn,co)if#cU~=#cV then rotate()end;local de=cm+cI;local df=cn+cJ;local dg=co+cK;for af=1,#cU,3 do cU[af]=cU[af]-cP+de;cU[af+1]=cU[af+1]-cQ+df;cU[af+2]=cU[af+2]-cR+dg end;ah=cm;ai=cn;z=co;cP=de;cQ=df;cR=dg end;function cN.setPosition(cm,cn,co)cN.movePoints(cm,cn,co)cO.setPosition(cm+cI,cn+cJ,co+cK)end;function cN.setDrawOrder(dh)local drawOrder={}for af=1,#dh do local aW=dh[af]local aX=drawOrder[aW*3-2]if not aX then aX={}drawOrder[aW*3-2]=aX end;aX[#aX+1]=af*2-1 end;cW[7]=drawOrder end;function cN.setDrawData(at)cW[8]=at end;function cO.getDrawOrder()return cW[7]end;function cO.getDrawData()return cW[8]end;function cO.getPointSet()return cW[9]end;function cO.getRawPoints()return cV end;function cO.setDrawOrder(drawOrder)cW[7]=drawOrder end;function cO.setDrawData(at)cW[8]=at end;function cO.setPoints(a8)cU=a8;cW[9]=a8 end;function cO.setRawPoints(di)cV=di end;function cO.setElementIndex(dj)cT=dj end;function cO.getElementIndex(dj)return cT end;function cO.getPosition()return ah,ai,z end;function cO.setPosition(cP,cQ,cR)ah=cP-cI;ai=cQ-cJ;z=cR-cK;cW[10]=cP;cW[11]=cQ;cW[12]=cR end;function cO.setNormal(cs,ct,cu)cW[13]=cs;cW[14]=ct;cW[15]=cu end;function cO.setBounds(cy)cW[16]=cy end;function cN.build(dk,dl)if#cU~=#cV or dk then rotate()end;local cs,ct,cu=cc(cU)if cs then if cW[2]then if not cW[3]then cW[3]=cW[2]end;if not cW[1]then cW[1]=cW[2]end;for af=1,#cU,3 do cU[af]=cU[af]+cP;cU[af+1]=cU[af+1]+cQ;cU[af+2]=cU[af+2]+cR end;cO.setNormal(cs,ct,cu)if not dk then cD=cD+1;if dl or dl==nil then local cy=cx(cV)cO.setBounds(cy)else cO.setBounds(false)end end;cA[cT]=cW else f("Element Malformed: No default draw.")end else f("Element Malformed: Insufficient points.")end end;return c_,cW end;function self.createText(cP,cQ,cR,cz)local dm,dn=cM(cP,cQ,cR,cz or 0)local dp=dm.user;local dq=dm.raw;function dp.setData(dr)drawOrder,wPoints=dr.getPoints()local at,ca=dr.getDrawStrings()dp.setDefaultDraw(ca)dp.setHoverDraw(ca)dp.setClickDraw(ca)dq.setDrawOrder(drawOrder)dq.setDrawData(at)dq.setRawPoints(wPoints)end;return dp end;function self.createButton(a1,a2,a3)local ds,dt=cM(a1,a2,a3)local dp=ds.user;local dq=ds.raw;function dp.setText(dn,cE,cF,cG)local du=self.createText(a1+cE,a2+cF,a3+cG,1)du.setData(dn)du.build(false,false)return du end;return dp end;function self.createProgressBar(dv,dw,dx)local dy,dz=cM(dv,dw,dx)local dA,bI=cM(dv,dw,dx,1)local dB=dy.user;local dC=dy.raw;local dD=dA.user;local dE=dA.raw;local dF={}local dG={}local dH={}local dI=100;function dB.getIntervals()return dH end;function dB.getProgress(dJ)local a8=dE.getRawPoints()if dJ then local y=dH[1]local dK=y[1]local dL=(dJ-a8[dF[1]])/dK;if dL<0 then return 0.001 elseif dL>100 then return 100 else return dL end end;return dI end;local function dM()local dN=#dF;local dO=#dG;local a8=dE.getRawPoints()if dN==dO then for af=1,dN do local dP=dF[af]local dQ=dG[af]local dR=(a8[dQ]-a8[dP])*0.01;local dS=(a8[dQ+1]-a8[dP+1])*0.01;local dT=(a8[dQ+2]-a8[dP+2])*0.01;dH[af]={dR,dS,dT}end else end end;function dB.setStartPoints(dU,aX)local dV=dD.addPoints(dU)if aX then for af=1,#aX do dF[af]=dV[aX[af]]end else dF=dV end;dM()end;function dB.setEndPoints(dW,aX)local dX=dD.addPoints(dW)if aX then for af=1,#aX do dG[af]=dX[aX[af]]end else dG=dX end;dM()end;function dB.updateProgress(dL)dI=dL or 0;local a8=dE.getRawPoints()for af=1,#dG do local y=dH[af]local dK,dY,dZ=y[1],y[2],y[3]local dP=dF[af]local dQ=dG[af]a8[dQ]=a8[dP]+dK*dI;a8[dQ+1]=a8[dP+1]+dY*dI;a8[dQ+2]=a8[dP+2]+dZ*dI end;dB.build(true)dD.build(true)end;return dB,dD end;local function d_(e0,e1)local e1=e1*0.5;local aN=e0*0.5;return{{-aN,0,e1},{-aN,0,-e1},{aN,0,-e1},{aN,0,e1}}end;function self.createTableDraw(cP,cQ,cR)local e2=cM(cP,cQ,cR)local dB=e2.user;local dC=e2.raw;local e3={}local y=1;local e4=0;local e5=0;local function e6(ah,ai,z,D,ae,dn,aq,c5,e7,e8)local e9=Text(dn,aq,textAlignments.middle,textAlignments.middle)local dt=self.createButton(ah,ai,z)dt.setDefaultDraw('<path stroke-width="%gpx" stroke="%s" fill="%s" d="M%g %g L%g %g L%g %g L%g %g Z"/>')dt.setHoverAction(e7)dt.setClickAction(e8)dt.setText(e9,0,-0.005,0)dt.setDrawData(c5)dt.addPoints(d_(D,ae))dt.build()return dt end;function e3.addColumn(ea,D,ae)e3[y]={ea,D,ae,{}}y=y+1;e6(cP+e5,cQ,cR,D,ae,ea,ae*0.9,{0.01,'black','green'},hoverAction,clickAction)if e4==0 then e4=e4-ae*0.5 end;e5=e5+D end;local eb=true;function e3.addRow(ec,ae,ed,ee,bI,clickAction,hoverAction)local ef=0;local eg=true;if eb then e4=e4-ae*0.5;eb=false end;for af=1,#e3 do local eh=ec[af]local ei=e3[af]local D=ei[2]local ej=ei[4]ej[#ej+1]={e6(cP+ef,cQ,cR+e4,D,ae,eh,ae*0.9,{ee,ed,bI},hoverAction,clickAction),D,ae}ef=ef+D end;e4=e4-ae;function ec.hide()if eg then end end;function ec.show()if not eg then end end end;return e3 end;function self.createCustomDraw(bU)local self={}return self end;function self.createSlider(ek,bU)local self={}return self end;return self end;function self.rotateHeading(b0)self[10][2]=self[10][2]+br(b0)end;function self.rotatePitch(aZ)self[10][1]=self[10][1]+br(aZ)end;function self.rotateRoll(a_)self[10][3]=self[10][3]+br(a_)end;function self.setPosition(el,em,en)self[11]={el,em,en}end;function self.addSubObject(bl,bm)local bm=bm or#self[6]+1;self[6][bm]=bl;return bm end;function self.removeSubObject(bm)self[6][bm]={}end;function self.setSubObjects()local self={}local y=1;function self.addSubObject(bl)self[6][y]=bl;y=y+1;return self end;return self end;return self end;function ObjectBuilderLinear()local self={}function self.setStyle(bh)local self={}local bh=bh;function self.setPosition(eo)local self={}local eo=eo;function self.setOffset(aV)local self={}local aV=aV;function self.setOrientation(bo)local self={}local bo=bo;function self.setPositionType(bp)local self={}local bp=bp;function self.setOrientationType(bq)local self={}local bq=bq;local bj,bk=nil,nil;function self.setTranslation(ep,eq)bj,bk=ep,eq;return self end;function self.build()return Object(bh,eo,aV,bo,bp,bq,bj,bk)end;return self end;return self end;return self end;return self end;return self end;return self end;return self end;local br=math.rad;cameraTypes={fixed={fLocal={name="fLocal",pitchPos=nil,pitchNeg=nil,headingPos=nil,headingNeg=nil,shift={0,0,0}},fGlobal={name="fGlobal",pitchPos=nil,pitchNeg=nil,headingPos=nil,headingNeg=nil,shift={0,0,0}}},player={jetpack={name="jetpack",pitchPos=nil,pitchNeg=nil,headingPos=nil,headingNeg=nil,shift={0,0,1.9}},planet={name="planet",pitchPos=br(75),pitchNeg=br(-75),headingPos=nil,headingNeg=nil,shift={0,0,1.85}},construct={name="construct",pitchPos=br(75),pitchNeg=br(-75),headingPos=nil,headingNeg=nil,shift={0,0,1.8}},chair={firstPerson={mouseControlled={name="chairfp_mouse",pitchPos=nil,pitchNeg=nil,headingPos=nil,headingNeg=nil,shift={-0.1,0,1.65}},freelook={name="chairfp_free",pitchPos=br(75),pitchNeg=br(-75),headingPos=br(95),headingNeg=br(-95),shift={-0.1,0,1.65}}},secondPerson={name="chairsp",pitchPos=0,pitchNeg=0,headingPos=0,headingNeg=0,shift={0,0,0}},thirdPerson={name="chairtp",pitchPos=br(84),pitchNeg=br(-89),headingPos=nil,headingNeg=nil,shift={0,0,0}}}}}local function er()local es=core.getElementIdList()local et=core.getElementTypeById;local eu=core.getElementPositionById;local cOff=cOff;local ev={}local y=1;for af=1,#es do local ew=et(es[af])if ew=="Gunner Module"then ev[y]=eu(es[af])y=y+1 end;if ew=="Command Seat Controller"then ev[y]=eu(es[af])y=y+1 end;if ew=="Wooden Chair"then ev[y]=eu(es[af])y=y+1 end;if ew=="Hovercraft Seat Controller"then ev[y]=eu(es[af])y=y+1 end end;return ev end;function Camera(ex,bn,bo)local core=core;local system=system;local unit=unit;local ey=unit.getClosestPlanetInfluence;local ez=false;local f,eA,br,eB=system.print,cameraTypes,math.rad,math.abs;local eC=er()local bn={bn[1],bn[2],bn[3]}local self={cType=ex,position=bn,orientation={br(bo[1]),br(bo[2]),br(bo[3])},isViewLocked=ez,cameraShift}function self.rotateHeading(b0)self.orientation[2]=self.orientation[2]+br(b0)end;function self.rotatePitch(aZ)self.orientation[1]=self.orientation[1]+br(aZ)end;function self.rotateRoll(a_)self.orientation[3]=self.orientation[3]+br(a_)end;function self.setAlignmentType(eD)self.cType=eD end;function self.setPosition(eo)self.position={eo[1],eo[2],eo[3]}end;function self.setViewLock(ez)self.isViewLocked=ez end;function self.getAlignmentType(E,F,G,H,eE,eF,eG)local eH=eA.player;local eD=eH.construct;if self.cType.name=="fLocal"then eD=eA.fixed.fLocal;return eD elseif self.cType.name=="fGlobal"then eD=eA.fixed.fGlobal;return eD end;if E~=nil then if E>0.001 or E<-0.001 or F>0.001 or F<-0.001 then eD=eH.jetpack end;if ey()>0.85 then eD=eH.planet end;local eC=eC;local eB=eB;for af=1,#eC do local eI=eC[af]local eJ=eB(eI[1]-eE)local eK=eB(eI[2]-eF)local eL=eB(eI[3]-eG)if eJ<0.4 and eK<0.4 and eL<0.4 then local eM=switched%3;if eM==0 then local eN=eH.chair.firstPerson;if self.isViewLocked then eD=eN.mouseControlled else eD=eN.freelook end;return eD elseif eM==1 then eD=eH.chair.thirdPerson;return eD elseif eM==2 then eD=eH.chair.secondPerson;return eD end end end end;switched=0;return eD end;return self end;function Projector(core,eO)local eP=false;local eQ=require('cpml.utils')local library=library;local core=core;local unit=unit;local system=system;local eR=getManager()local a=library.systemResolution3;local eS=system.getScreenWidth;local eT=system.getScreenHeight;local eU=system.getFov;local eV=system.getMouseDeltaX;local eW=system.getMouseDeltaY;local f=system.print;local eX=core.getConstructWorldPos;local eY=core.getConstructWorldRight;local eZ=core.getConstructWorldForward;local e_=core.getConstructWorldUp;local f0=unit.getMasterPlayerPosition;local f1=eO.getAlignmentType;local f2=eR.getLocalToWorldConverter;local f3=eR.getWorldToLocalConverter;local f4=eR.getPlayerLocalRotation;local f5,f6,f7,f8,f9=eR.inverse,eR.multiply,eR.transPoint3D,eR.rotMatrixToEuler,eR.rotMatrixToQuat;local fa,fb,fc,br,fd,b,c,fe,ff=math.sin,math.cos,math.tan,math.rad,math.deg,math.sqrt,math.atan,math.ceil,math.floor;local fg=eQ.round;local e0=eS()*0.5;local e1=eT()*0.5;local aV=0;local fh=br(eU()+aV)local fi=fc(fh*0.5)*e1/e0;local fj=e0/e1;local fk=e0/fi;local fl=fk*fi;local fm=-fl;local fn=fm*fj;local V=fl*fj;local fo=2*fk/(V-fn)local fp=2*fk/(fl-fm)local fq=unit.getMasterPlayerId()local fr=unit.getId()local fs=eO.position;local ft=eO.orientation;local fu=eO.cType;local eD=nil;local fv=1;local aI=fv*e0*2*0.00104584100642898+0.00222458611638299;local fw=false;local fx=false;local fy=false;local fz=false;local fA={}local self={objectGroups=fA}function self.getSize(ak,fB,fC,fD)local fE=c(ak,fB)*fk/fj;local fC=fC or fE;local fD=fD or fE;if fE>=fC then return fC elseif fE<=fD then return fD else return fE end end;local function J(K,L,M,N,O,P,Q,R,S)local T=K+O+S;if T>0 then local r=0.5/b(T+1)return(P-R)*r,(Q-M)*r,(L-N)*r,0.25/r elseif K>O and K>S then local r=2*b(1+K-O-S)return 0.25*r,(N+L)/r,(Q+M)/r,(P-R)/r elseif O>S then local r=2*b(1+O-K-S)return(N+L)/r,0.25*r,(R+P)/r,(Q-M)/r else local r=2*b(1+S-K-O)return(Q+M)/r,(R+P)/r,0.25*r,(L-N)/r end end;function self.updateCamera()if fu.name~="fGlobal"and fu.name~="fLocal"then local c=c;eP=clicked;clicked=false;fs=f0()local fF,fG=eV(),eW()local e0=e0;local fH=c(-fG,e0)*aI;local fI=c(fF,e0)*aI;local fJ=ft[1]local fK=ft[2]local fL=eD;if fL==nil then fL=f1()end;local fM,fN=fL.pitchPos,fL.pitchNeg;local fO,fP=fL.headingPos,fL.headingNeg;if fM~=nil then if not(fw or fx)then fJ=fJ+fH;if fJ<=fN then fJ=fN;fw=true end;if fJ>=fM then fJ=fM;fx=true end else if fw and fG<0 then fw=false;fJ=fJ+fH end;if fx and fG>0 then fx=false;fJ=fJ+fH end end;ft[1]=fJ else ft[1]=0 end;if fO~=nil then if not(fz or fy)then fK=fK+fI;if fK<=fP then fK=fP;fz=true end;if fK>=fO then fK=fO;fy=true end else if fy and fF<0 then fy=false;fK=fK+fI end;if fz and fF>0 then fz=false;fK=fK+fI end end;ft[2]=fK else ft[2]=0 end end end;function self.addObjectGroup(fQ,bm)local aW=bm or#fA+1;fA[aW]=fQ;return aW end;function self.removeObjectGroup(bm)fA[bm]={}end;local fR,fS,fT=nil,nil,nil;local fU,fV,fW=nil,nil,nil;local fX,fY,fZ=nil,nil,nil;local cm,cn,co,f_=nil,nil,nil,nil;function self.getModelMatrices(g0)local r,y,g1,f5=fa,fb,f6,f5;local g2={}local g3=g0[10]local g4=g0[12]local g5,g6,g7=g4[1],g4[2],g4[3]local fX,fY,fZ=fX,fY,fZ;local fU,fV,fW=fU,fV,fW;local fR,fS,fT=fR,fS,fT;local cm,cn,co,f_=-cm,-cn,-co,f_;local g8=2;local function g9(ga,gb,gc,gd,ge,gf,gg,bl,gh,gi,gj)local ga,gb,gc,gd=ga,gb,gc,-gd;local g4=bl[12]local gk=bl[10]local gl,gm,gn=g4[1],g4[2],g4[3]local go,gp,gq=gk[1]*0.5,gk[2]*0.5,gk[3]*0.5;local b1,b2,b3=r(go),r(gq),r(gp)local b4,b5,b6=y(go),y(gq),y(gp)local gr,gs,gt,gu=b1*b5*b6-b4*b2*b3,b4*b2*b6+b1*b5*b3,b4*b5*b3-b1*b2*b6,b4*b5*b6+b1*b2*b3;local gv,gw,wz,gx=gr,gs,gt,gu;local gy,gz,gA=f7(ga,gb,gc,gd,gl,gm,gn)if bl[8]==2 then local gB=fX*gy+fU*gz+fR*gA;local gC=fY*gy+fV*gz+fS*gA;local gD=fZ*gy+fW*gz+fT*gA;gy=gB;gz=gC;gA=gD end;gy,gz,gA=gy+gh,gz+gi,gA+gj;if bl[9]==2 then gv,gw,wz,gx=g1(gv,gw,wz,gx,cm,cn,co,f_)end;local gE,gF,gG,gH=gv*gv,gw*gw,wz*wz,gx*gx;local b8,b9,ba=1-2*(gF+gG),2*(gv*gw-wz*gx),2*(gv*wz+gw*gx)local bb,bc,bd=2*(gv*gw+wz*gx),1-2*(gE+gG),2*(gw*wz-gv*gx)local be,bf,bg=2*(gv*wz-gw*gx),2*(gw*wz+gv*gx),1-2*(gE+gF)g2[g8]={bl,{b8,bb,be,gy,b9,bc,bf,gz,ba,bd,bg,gA,0,0,0,1}}g8=g8+1;local bz=bl[7]if#bz>0 then for ay=1,#bz do local gI=bz[ay]if gI[12]~=nil then recurse.subObjectMatrices(gr,gs,gt,gu,gl,gm,gn,gI,gy,gz,gA)end end end end;local aZ,b0,a_=g3[1]*0.5,g3[2]*0.5,g3[3]*0.5;local b1,b2,b3=r(aZ),r(a_),r(b0)local b4,b5,b6=y(aZ),y(a_),y(b0)local gr=b1*b5*b6-b4*b2*b3;local gs=b4*b2*b6+b1*b5*b3;local gt=b4*b5*b3-b1*b2*b6;local gu=b4*b5*b6+b1*b2*b3;local gv,gw,wz,gx=gr,gs,gt,gu;if g0[9]==2 then gv,gw,wz,gx=f6(gv,gw,wz,gx,cm,cn,co,f_)end;local gE,gF,gG,gH=gv*gv,gw*gw,wz*wz,gx*gx;local gJ,gK,gL=1-2*(gF+gG),2*(gv*gw-wz*gx),2*(gv*wz+gw*gx)local gM,gN,gO=2*(gv*gw+wz*gx),1-2*(gE+gG),2*(gw*wz-gv*gx)local gP,gQ,gR=2*(gv*wz-gw*gx),2*(gw*wz+gv*gx),1-2*(gE+gF)if g0[8]==2 then local gB=fX*g5+fU*g6+fR*g7;local gC=fY*g5+fV*g6+fS*g7;local gD=fZ*g5+fW*g6+fT*g7;g5=gB;g6=gC;g7=gD else local gS=eX()g5=g5-gS[1]g6=g6-gS[2]g7=g7-gS[3]end;local gT=g0[7]if#gT>0 then for ay=1,#gT do local gI=gT[ay]if gI[7]~=nil then g9(gr,gs,gt,gu,g4[1],g4[2],g4[3],gI,g5,g6,g7)end end end;g2[1]={g0,{gJ,gM,gP,g5,gK,gN,gQ,g6,gL,gO,gR,g7,0,0,0,1}}return g2 end;local function gU()local r=a;local gV,gW,b6=e_(),eZ(),eY()fX,fY,fZ,fU,fV,fW,fR,fS,fT=b6[1],b6[2],b6[3],gW[1],gW[2],gW[3],gV[1],gV[2],gV[3]cm,cn,co,f_=J(fX,fY,fZ,fU,fV,fW,fR,fS,fT)end;function self.getViewMatrix()local gX=system.getTime()gU()logRefentialsUpdate.addValue(system.getTime()-gX)local r,y,g1,a=fa,fb,f6,a;local fs=fs;local gY,gZ,g_=fs[1],fs[2],fs[3]local gB,gC,gD=gY,gZ,g_;local gv,gw,wz,gx=0,0,0,1;local E,F,G,H=f4()local cm,cn,co,f_=cm,cn,co,f_;local h0=f1(E,F,G,H,gY,gZ,g_)eD=h0;local h1=h0.shift;local h2,h3,h4=f7(E,F,G,H,h1[1],h1[2],h1[3])local h5=h0.name;local h6=h5=="fGlobal"local h7=h5=="fLocal"local aZ,b0=ft[1]*0.5,-ft[2]*0.5;if aZ~=0 or b0~=0 or h6 or h7 then local b1,b3=r(aZ),r(b0)local b4,b6=y(aZ),y(b0)local h8=b1*b6;local h9=b1*b3;local ha=b4*b3;local hb=b4*b6;if not h6 and not h7 then E,F,G,H=g1(E,F,G,H,h8,h9,ha,hb)elseif h6 then gv,gw,wz,gx=h8,h9,ha,hb else gv,gw,wz,gx=g1(cm,cn,co,f_,h8,h9,ha,hb)end end;if not h6 and not h7 then local a5,a6,a7,I=E*E,F*F,G*G,H*H;gY=gY+h2;gZ=gZ+h3;g_=g_+h4;gB=2*((0.5-a6-a7)*gY+(E*F+G*H)*gZ+(E*G-F*H)*g_)gC=2*((E*F-G*H)*gY+(0.5-a5-a7)*gZ+(F*G+E*H)*g_)gD=2*((E*G+F*H)*gY+(F*G-E*H)*gZ+(0.5-a5-a6)*g_)gv,gw,wz,gx=g1(cm,cn,co,f_,E,F,G,H)end;fs[1],fs[2],fs[3]=f7(cm,cn,co,f_,gY,gZ,g_)local gE,gF,gG,gH=gv*gv,gw*gw,wz*wz,gx*gx;return{1-2*(gF+gG),2*(gv*gw+wz*gx),2*(gv*wz-gw*gx),-gB,2*(gv*gw-wz*gx),1-2*(gE+gG),2*(gw*wz+gv*gx),-gC,2*(gv*wz+gw*gx),2*(gw*wz-gv*gx),1-2*(gE+gF),-gD}end;function self.getSVG(hc,y)hc=hc or{}y=y or 1;local hd=system.getTime;local gX=hd()local he=self.getViewMatrix()local hf=hd()logVMatrix.addValue(hf-gX)local hg=hd()local hh,hi,hj,hk=he[1],he[2],he[3],he[4]local hl,hm,hn,ho=he[5],he[6],he[7],he[8]local hp,hq,hr,hs=he[9],he[10],he[11],he[12]local ht=(hl+hm+hn)/(hl*hl+hm*hm+hn*hn)local hu=hl*ht;local hv=hm*ht;local hw=hn*ht;local hx=fk/fj;local gY,gZ,g_=fs[1],fs[2],fs[3]local hy,c,hz,hA,hB,aJ,eB,f5,f7,hC=self.getSize,c,table.sort,string.format,table.unpack,table.concat,math.abs,f5,f7,self.getModelMatrices;local function hD(hf,hg)return hf[1]>hg[1]end;local function hE(hc,y,ah,ai,dn,ak,hF,bI)hc[y]='<text x="'hc[y+1]=ah;hc[y+2]='" y="'hc[y+3]=ai;y=y+4;if hF then hc[y]='" fill-opacity="'hc[y+1]=hF;hc[y+2]='" stroke-opacity="'hc[y+3]=hF;y=y+4 end;if bI then hc[y]='" fill="'hc[y+1]=bI;y=y+2 end;if ak then hc[y]='" font-size="'hc[y+1]=ak;y=y+2 end;hc[y]='">'hc[y+1]=dn;hc[y+2]='</text>'return y+3 end;local hG=fo;local hH=fp;local e0=e0;local e1=e1;local hI,hJ,hK,hL=-e0*2,e0*2,-e1*2,e1*2;local fA=fA;local hM=hd()logPreRead.addValue(hM-hg)local hN=hd()mDiff=0;preCDiff=0;lineDiff=0;circleDiff=0;curveDiff=0;cGroupDiff=0;sGroupDiff=0;sGroupFDiff=0;mGroupDiff=0;mGroupFDiff=0;trigGroupDiff=0;uiTotalDiff=0;uiCalDiff=0;uiSortDiff=0;uiPostDiff=0;uiFormatDiff=0;local hO,hP={},{}for af=1,#fA do local fQ=fA[af]if fQ.enabled==false then goto hQ end;local hR=fQ.transX or e0;local hS=fQ.transY or e1;local bi=fQ.objects;hc[y]=hA('<svg viewBox="0 0 %g %g" class="%s"><g transform="translate(%g,%g)">',e0*2,e1*2,fQ.style,hR,hS)y=y+1;for aI=1,#bi do local hT=bi[aI]if hT[12]==nil then goto hU end;local hV=hd()local hW=hC(hT)mDiff=mDiff+hd()-hV;for ay=1,#hW do local hX=hW[ay]local bl=hX[1]local hY=hX[2]local hZ=bl[11]local h_=bl[14]or 0;local i0=bl[15]or 0;if h_~=0 or i0~=0 then hc[y]=hA('<g class="%s" transform="translate(%g,%g)">',hZ,h_,i0)else hc[y]=hA('<g class="%s">',hZ)end;y=y+1;local i1=hd()local i2,i3,i4,i5=hY[1],hY[2],hY[3],hY[4]local i6,i7,i8,i9=hY[5],hY[6],hY[7],hY[8]local ia,ib,ic,id=hY[9],hY[10],hY[11],hY[12]local ie=hG*e0;local ig,ih,ii,ij=(hh*i2+hi*i6+hj*ia)*ie,(hh*i3+hi*i7+hj*ib)*ie,(hh*i4+hi*i8+hj*ic)*ie,(hk+hh*i5+hi*i9+hj*id)*ie;local ik,il,im,io=hl*i2+hm*i6+hn*ia,hl*i3+hm*i7+hn*ib,hl*i4+hm*i8+hn*ic,ho+hl*i5+hm*i9+hn*id;local ip=-hH*e1;local iq,ir,is,it=(hp*i2+hq*i6+hr*ia)*ip,(hp*i3+hq*i7+hr*ib)*ip,(hp*i4+hq*i8+hr*ic)*ip,(hs+hp*i5+hq*i9+hr*id)*ip;local iu,iv,iw=gY-i5,gZ-i9,g_-id;preCDiff=preCDiff+hd()-i1;local bt,bu,ix,bw,bx,by=bl[1],bl[2],bl[3],bl[4],bl[5],bl[6]local iy=hd()for ab=1,#bt do local iz=bt[ab]hc[y]=hA('<path class="%s" d="%s"/>',iz[1])y=y+1;for t=2,#iz do local bE=iz[t]hc[y]='M 'local iA=0;local iB,iC=nil,nil;local iD,iE=nil,nil;y=y+1;for ae=1,#bE do local iF=bE[ae]local ah,ai,z=iF[1],iF[2],iF[3]local cK=ik*ah+il*ai+im*z+io;if cK<0 then goto iG end;local gv=(ig*ah+ih*ai+ii*z+ij)/cK;local gw=(iq*ah+ir*ai+is*z+it)/cK;if iA~=0 then hc[y]=' L 'y=y+1;iD,iE=gv,gw else iB,iC=gv,gw end;hc[y]=gv;hc[y+1]=' 'hc[y+2]=gw;y=y+3;iA=iA+1::iG::end;if iA<2 then if iA==1 then y=y-4 else y=y-1 end else if iD==iB and iE==iC then hc[y-4]=' Z 'y=y-3 end end end;hc[y]='"/>'y=y+1 end;local iH=hd()lineDiff=lineDiff+iH-iy;local iI=hd()for iJ=1,#bu do local iK=bu[iJ]hc[y]=hA('<g class="%s">',iK[1])y=y+1;for iL=2,#iK do local iM=iK[iL]local iF=iM[1]local ah,ai,z=iF[1],iF[2],iF[3]local cK=ik*ah+il*ai+im*z+io;if cK<0 then goto iN end;local gv=(ig*ah+ih*ai+ii*z+ij)/cK;local gw=(iq*ah+ir*ai+is*z+it)/cK;local bH,bI,bJ,bK,bL,ak,bM,bN=iM[2],iM[3],iM[4],iM[5],iM[6],iM[7],iM[8],iM[9]hc[y]=hA('<circle cx="%g" cy="%g" r="%g" fill="%s"/>',gv,gw,bH,bI)y=y+1;if bJ then hc[y]='<text x="'hc[y+1]=gv+bK;hc[y+2]='" y="'hc[y+3]=gw+bL;y=y+4;if ak then if bM==true then hc[y]='" font-size="'hc[y+1]=hy(ak,wz)else hc[y]='" font-size="'hc[y+1]=ak end;y=y+2 end;hc[y]='">'hc[y+1]=bJ;hc[y+2]='</text>'y=y+3 end;if bN then y=bN(hc,y,bl,gv,gw,cK)end::iN::end;hc[y]='</g>'y=y+1 end;local iO=hd()circleDiff=circleDiff+iO-iI;local iP=hd()for iQ=1,#ix do local iR=ix[iQ]local bT=iR[2]local iS={}local iT=0;hc[y]=hA('<g class="%s"><path d="',iR[1])y=y+1;for iU=1,#bT do local iV=bT[iU]if iV[1]==1 then local ag=iV[2]local bZ=iV[3]local iW={}for af=1,12 do local iF=ag[af]local ah,ai,z=iF[1],iF[2],iF[3]local cK=ik*ah+il*ai+im*z+io;if cK<0 then iW[af]={0,0,false}goto iX end;iW[af]={(ig*ah+ih*ai+ii*z+ij)/cK,(iq*ah+ir*ai+is*z+it)/cK,true}::iX::end;local iY,iZ,i_,j0,j1,j2,j3,j4,j5,j6,K,N=iW[1],iW[2],iW[3],iW[4],iW[5],iW[6],iW[7],iW[8],iW[9],iW[10],iW[11],iW[12]local j7,j8,j9,ja,jb,jc,jd,je,jf,jg=iY[1],iY[2],iY[3],iZ[1],iZ[2],i_[1],i_[2],j0[1],j0[2],j0[3]if iY[3]and iY[3]and iY[3]and jg then hc[y]=hA('M%g %gC%g %g,%g %g,%g %g',j7,j8,ja,jb,jc,jd,je,jf)y=y+1 end;local jh,ji,jj,jk,jl,jm,jn=j1[1],j1[2],j2[1],j2[2],j3[1],j3[2],j3[3]if jg and j1[3]and j2[3]and jn then hc[y]=hA('M%g %gC%g %g,%g %g,%g %g',je,jf,jh,ji,jj,jk,jl,jm)y=y+1 end;local jo,jp,jq,jr,js,jt,ju=j4[1],j4[2],j5[1],j5[2],j6[1],j6[2],j6[3]if jn and j4[3]and j5[3]and ju then hc[y]=hA('M%g %gC%g %g,%g %g,%g %g',jl,jm,jo,jp,jq,jr,js,jt)y=y+1 end;local jv,jw,jx,jy=K[1],K[2],N[1],N[2]if ju and K[3]and N[3]and j9 then hc[y]=hA('M%g %gC%g %g,%g %g,%g %g',js,jt,jv,jw,jx,jy,j7,j8)y=y+1 end;if bZ[1]then if j9 and jg and jn and ju then iS[iT+1]={{j7,j8,j9},{je,jf,jg},{jl,jm,jn},{js,jt,ju},bZ}iT=iT+1 end end else end end;hc[y]='"/>'y=y+1;if iT>0 then for jz=1,iT do local jA=iS[jz]local dn=dat[1]local r=dat[3]for af=1,4 do local iF=jA[af]local r=r;if dat[2]then r=hy(r,iF[3],100,1)end;hc[y]=hA('<text x="%g" y="%g" fill="white" font-size="%g">%s</text>',iF[1],iF[2],r,dn)y=y+1 end end end end;local jB=hd()curveDiff=curveDiff+jB-iP;local jC=hd()for iJ=1,#bw do local jD=bw[iJ]local jE=jD[2]local jF=jD[3]hc[y]=hA('<g class="%s">',jD[1])y=y+1;local jG=hd()for jH=1,#jE do local jI=jE[jH]local ag=jI[1]local jJ={}local g8=1;local jK={}for c7=1,#ag do local iF=ag[c7]local ah,ai,z=iF[1],iF[2],iF[3]local cK=ik*ah+il*ai+im*z+io;if cK<0 then goto jL end;jJ[g8]={(ig*ah+ih*ai+ii*z+ij)/cK,(iq*ah+ir*ai+is*z+it)/cK,cK}jK[g8]={i2*ah+i3*ai+i4*z,i6*ah+i7*ai+i8*z,ia*ah+ib*ai+ic*z}g8=g8+1::jL::end;if g8~=1 then local c6=jI[2]local c5=jI[3]local jM=hd()y=c6(hc,y,bl,jJ,c5)local jN=hd()mGroupFDiff=mGroupFDiff+jN-jM end end;local jO=hd()mGroupDiff=mGroupDiff+jO-jG;for jP=1,#jF do local jQ=jF[jP]local iF=jQ[1]local ah,ai,z=iF[1],iF[2],iF[3]local cK=ik*ah+il*ai+im*z+io;if cK<0 then goto jR end;local c6=jQ[2]local c5=jQ[3]local jM=hd()y=c6(hc,y,bl,(ig*ah+ih*ai+ii*z+ij)/cK,(iq*ah+ir*ai+is*z+it)/cK,cK,c5)local jN=hd()sGroupFDiff=sGroupFDiff+jN-jM::jR::end;local jS=hd()sGroupDiff=sGroupDiff+jS-jO;hc[y]='</g>'y=y+1 end;local jT=hd()cGroupDiff=cGroupDiff+jT-jC;local jU=true;local jV=hd()for jW=1,#by do local jX=by[jW]local cA=jX[2]local jY={}local jZ=0;local j_=hd()for cD=1,#cA do local ew=cA[cD]if not ew[6]then goto k0 end;local k1,k2,k3=ew[10],ew[11],ew[12]local k4=ik*k1+il*k2+im*k3+io;if k4<0 then goto k0 end;local drawOrder=ew[7]local at=ew[8]local a8=ew[9]local k5={}local k6=1;if at then local k7=#at;local ee=c(at[1],k4)*hx;k5[1]=ee;for k8=2,k7 do k5[k8]=at[k8]end;k6=k7+1 end;local k9=false;if not drawOrder then for ka=1,#a8,3 do local dv,dw,dx=a8[ka],a8[ka+1],a8[ka+2]local cK=ik*dv+il*dw+im*dx+io;if cK<0 then k9=true;break end;k5[k6]=(ig*dv+ih*dw+ii*dx+ij)/cK;k5[k6+1]=(iq*dv+ir*dw+is*dx+it)/cK;k6=k6+2 end else for ka=1,#a8,3 do local dv,dw,dx=a8[ka],a8[ka+1],a8[ka+2]local cK=ik*dv+il*dw+im*dx+io;if cK<0 then k9=true;break end;local cI=(ig*dv+ih*dw+ii*dx+ij)/cK;local cJ=(iq*dv+ir*dw+is*dx+it)/cK;local kb=drawOrder[ka]for af=1,#kb do local aW=kb[af]+k6-1;k5[aW]=cI;k5[aW+1]=cJ end end end;if not k9 then local kc,kd,ke=i2*k1+i3*k2+i4*k3,i6*k1+i7*k2+i8*k3,ia*k1+ib*k2+ic*k3;jZ=jZ+1;jY[jZ]={eB((kc-iu)*hu+(kd-iv)*hv+(ke-iw)*hw),{ew[1],ew[2],ew[3]},k5,kc,kd,ke,ew[13],ew[14],ew[15],ew[16],ew[4],ew[5],ew[17],ew[18],ew[19],ew[20],k1,k2,k3}end::k0::end;uiCalDiff=uiCalDiff+hd()-j_;local kf=hd()hz(jY,hD)uiSortDiff=uiSortDiff+hd()-kf;local kg=hd()local kh=0;for dZ=jZ,1,-1 do local ki=jY[dZ]local kj=ki[2]local kk=jU;local kl,km=0,0;if kk then local kn=ki[10]if kn then local ko,kp,kq,kc,kd,ke=ki[7],ki[8],ki[9],ki[4],ki[5],ki[6]local kr=i2*ko+i3*kp+i4*kq;local ks=i6*ko+i7*kp+i8*kq;local kt=ia*ko+ib*kp+ic*kq;local iu=iu-kc;local iv=iv-kd;local iw=iw-ke;local T=-(iu*kr+iv*ks+iw*kt)/(hl*kr+hm*ks+hn*kt)local cI,cJ,cK=iu+T*hl,iv+T*hm,iw+T*hn;local ku,kv,kw,kx=ki[13],ki[14],ki[15],ki[16]local ky=kv*kv;local b8,ba=1-2*(ky+kw*kw),2*(ku*kw+kv*kx)local bb,bd=2*(ku*kv+kw*kx),2*(kv*kw-ku*kx)local be,bg=2*(ku*kw-kv*kx),1-2*(ku*ku+ky)local kz=i2*cI+i6*cJ+ia*cK;local kA=i3*cI+i7*cJ+ib*cK;local kB=i4*cI+i8*cJ+ic*cK;local dJ=b8*kz+bb*kA+be*kB;local kC=ba*kz+bd*kA+bg*kB;for kD=1,#kn,3 do if kn[kD]*dJ+kn[kD+1]*kC+kn[kD+2]<0 then kk=false;break end end;kl=dJ;km=kC else kh=kh+1;kk=false end end;local kE=kj[2]if kk then jU=false;kE=kj[1]if eP then kE=kj[3]f("Clicked")local clickAction=ki[11]if clickAction then clickAction(kl,km,ki[17],ki[18],ki[19])eP=false end else local hoverAction=ki[12]if hoverAction then hoverAction(kl,km,ki[17],ki[18],ki[19])end end end;ki[2]=kE end;uiPostDiff=uiPostDiff+hd()-kg;local kF=hd()hc[y]=hA('<g class="%s">',jX[1])y=y+1;for dZ=1,jZ do local ek=jY[dZ]local kE=ek[2]if kE then hc[y]=hA(kE,hB(ek[3]))y=y+1 end end;hc[y]='</g>'y=y+1;uiFormatDiff=uiFormatDiff+hd()-kF end;hc[y]='</g>'y=y+1;uiTotalDiff=uiTotalDiff+hd()-jV end::hU::end;hc[y]='</g></svg>'y=y+1::hQ::end;logPreCalc.addValue(preCDiff)logMMatrices.addValue(mDiff)logUITotal.addValue(uiTotalDiff)logUICompute.addValue(uiCalDiff)logUISort.addValue(uiSortDiff)logUIPost.addValue(uiPostDiff)logUIFormat.addValue(uiFormatDiff)logLineTotal.addValue(lineDiff)logCircleTotal.addValue(circleDiff)logCurveTotal.addValue(curveDiff)logCustomTotal.addValue(cGroupDiff)logSingleTotal.addValue(sGroupDiff)logSingleFunction.addValue(sGroupFDiff)logMultiTotal.addValue(mGroupDiff)logMultiFunction.addValue(mGroupFDiff)logTriTotal.addValue(trigGroupDiff)return hc,y,fk,hO end;return self end